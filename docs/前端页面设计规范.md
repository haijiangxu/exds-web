# 前端页面设计规范

本规范旨在确保电力交易辅助决策系统前端各功能模块的设计风格统一，提升用户体验和代码可维护性。

---

## 1. 页面结构规范

### 1.1 外层容器

**强制要求**：所有页面级组件必须使用以下外层容器结构：

```tsx
export const YourPage: React.FC = () => {
    return (
        <Box sx={{ width: '100%' }}>
            {/* 页面内容 */}
        </Box>
    );
};
```

❌ **禁止使用**：
- `<Container maxWidth="xl">` 或其他 Container 组件
- 自定义的宽度限制容器

**原因**：统一的容器确保页面在多页签布局中具有一致的宽度和间距表现。

---

### 1.2 页面标题

**强制要求**：使用 `Breadcrumbs` 组件展示页面层级，样式规范如下：

```tsx
<Breadcrumbs aria-label="breadcrumb" sx={{ mb: 2 }}>
    <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
        一级菜单名称
    </Typography>
    <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
        当前页面名称
    </Typography>
</Breadcrumbs>
```

**样式参数**：
- `fontSize`: `1.2rem`
- `fontWeight`: `600`
- `mb` (margin-bottom): `2`

❌ **禁止使用**：
- `PageHeader` 组件（已废弃，仅保留用于特殊场景）
- 大标题 + 小面包屑的组合样式
- 可点击的面包屑链接（除非有明确的导航需求）

**原因**：扁平化的面包屑设计更简洁，与多页签导航模式相匹配。

---

## 2. 组件样式规范

### 2.1 Paper 组件样式

根据使用场景，`Paper` 组件应遵循以下规范：

#### 场景 1：Tab 导航容器

```tsx
<Paper variant="outlined" sx={{ borderColor: 'divider' }}>
    <Tabs value={tabIndex} onChange={handleTabChange}>
        {/* Tab 内容 */}
    </Tabs>
</Paper>
```

**样式**：
- `variant`: `"outlined"`（轮廓样式，无阴影）
- `borderColor`: `'divider'`（使用主题分隔线颜色）

#### 场景 2：图表容器、表格容器

```tsx
<Paper sx={{ p: 2, mt: 3, height: 400 }}>
    <Typography variant="h6" gutterBottom>图表标题</Typography>
    {/* 图表或表格内容 */}
</Paper>
```

**样式**：
- 不指定 `variant` 或 `elevation`（使用默认的 `elevation={1}`）
- `p`: `2`（内边距）
- `mt`: `3`（顶部外边距，用于与上方内容分隔）

#### 场景 3：数据展示卡片（仪表板式布局）

```tsx
<Paper sx={{ p: 2, height: '100%' }} elevation={2}>
    <Typography variant="h6">卡片标题</Typography>
    {/* 卡片内容 */}
</Paper>
```

**样式**：
- `elevation`: `2`（轻微阴影，增强层次感）
- `p`: `2` 或 `3`（根据内容密度调整）
- `height`: `'100%'`（在 Grid 布局中自动填充）

**说明**：仅在仪表板式布局（如 GridAgencyPricePage）中的数据卡片使用 `elevation={2}`，其他场景使用默认样式。

---

### 2.2 Typography 组件规范

#### 标题层级

| 用途 | variant | 示例代码 |
|------|---------|----------|
| 面包屑层级 | - | `sx={{ fontSize: '1.2rem', fontWeight: 600 }}` |
| 卡片标题 | `h6` | `<Typography variant="h6">标题</Typography>` |
| 子标题 | `subtitle1` | `<Typography variant="subtitle1" gutterBottom sx={{ fontWeight: 'bold' }}>...</Typography>` |
| 正文 | `body1` | `<Typography variant="body1">...</Typography>` |
| 辅助文字 | `body2` | `<Typography variant="body2" color="text.secondary">...</Typography>` |

---

### 2.3 Grid 布局规范（Material-UI v7）

**极其重要**：本项目使用 Material-UI v7，Grid 组件 API 与 v5 **不兼容**。

✅ **正确语法**（必须使用 `size` 属性）：

```tsx
<Grid container spacing={3}>
    <Grid size={{ xs: 12, md: 6, lg: 4 }}>
        {/* 内容 */}
    </Grid>
    <Grid size={{ xs: 12, md: 6, lg: 4 }}>
        {/* 内容 */}
    </Grid>
</Grid>
```

❌ **错误语法**（会导致编译错误）：

```tsx
<Grid item xs={12} md={6}>  {/* 错误！ */}
<Grid xs={12}>              {/* 错误！ */}
```

**响应式断点建议**：
- `xs`: 移动端（<600px）
- `md`: 平板/小屏桌面（≥960px）
- `lg`: 大屏桌面（≥1280px）

---

## 3. 页面布局模式

### 3.1 Tab 式导航布局（推荐）

适用于包含多个子功能的分析页面，如负荷分析、价格分析等。

**结构**：

```tsx
export const YourAnalysisPage: React.FC = () => {
    const [tabIndex, setTabIndex] = useState(0);

    return (
        <Box sx={{ width: '100%' }}>
            {/* 页面标题 */}
            <Breadcrumbs aria-label="breadcrumb" sx={{ mb: 2 }}>
                <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
                    一级菜单
                </Typography>
                <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
                    当前页面
                </Typography>
            </Breadcrumbs>

            {/* Tab 导航 */}
            <Paper variant="outlined" sx={{ borderColor: 'divider' }}>
                <Tabs value={tabIndex} onChange={handleTabChange}>
                    <Tab label="子功能1" />
                    <Tab label="子功能2" />
                </Tabs>
            </Paper>

            {/* Tab 内容 */}
            <TabPanel value={tabIndex} index={0}>
                <SubFeature1Component />
            </TabPanel>
            <TabPanel value={tabIndex} index={1}>
                <SubFeature2Component />
            </TabPanel>
        </Box>
    );
};
```

**TabPanel 组件**：

```tsx
interface TabPanelProps {
    children?: React.ReactNode;
    index: number;
    value: number;
}

function TabPanel(props: TabPanelProps) {
    const { children, value, index, ...other } = props;
    return (
        <div
            role="tabpanel"
            hidden={value !== index}
            id={`tabpanel-${index}`}
            aria-labelledby={`tab-${index}`}
            {...other}
        >
            {value === index && (
                <Box sx={{ pt: 3 }}>
                    {children}
                </Box>
            )}
        </div>
    );
}
```

---

### 3.2 仪表板式布局

适用于数据概览和统计页面，展示多个数据卡片和图表。

**结构**：

```tsx
export const DashboardPage: React.FC = () => {
    return (
        <Box sx={{ width: '100%' }}>
            {/* 页面标题 */}
            <Breadcrumbs aria-label="breadcrumb" sx={{ mb: 2 }}>
                <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
                    一级菜单
                </Typography>
                <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
                    当前页面
                </Typography>
            </Breadcrumbs>

            {/* 数据卡片区 */}
            <Grid container spacing={3}>
                <Grid size={{ xs: 12, md: 6, lg: 4 }}>
                    <Paper sx={{ p: 2, height: '100%' }} elevation={2}>
                        {/* 卡片内容 */}
                    </Paper>
                </Grid>
                {/* 更多卡片... */}
            </Grid>

            {/* 图表区 */}
            <Paper sx={{ p: 2, mt: 3, height: 400 }}>
                <Typography variant="h6" gutterBottom>图表标题</Typography>
                {/* 图表内容 */}
            </Paper>

            {/* 表格区 */}
            <Paper sx={{ p: 2, mt: 3 }}>
                <Typography variant="h6" gutterBottom>数据详情</Typography>
                {/* 表格内容 */}
            </Paper>
        </Box>
    );
};
```

---

## 4. 响应式设计规范

### 4.1 移动端优先

**强制要求**：所有页面和组件必须采用移动端优先的响应式设计。

**检测断点**：

```tsx
import { useMediaQuery, Theme } from '@mui/material';

const isMobile = useMediaQuery((theme: Theme) => theme.breakpoints.down('sm'));
```

### 4.2 图表横屏全屏功能

**强制要求**：所有 Recharts 图表在移动端必须支持"横屏最大化"功能。

**实现方式**：使用项目内置的可复用 Hook `useChartFullscreen`。

**位置**：`frontend/src/hooks/useChartFullscreen.tsx`

**使用示例**：

```tsx
const {
    isFullscreen,
    FullscreenEnterButton,
    FullscreenExitButton,
    FullscreenTitle,
    NavigationButtons
} = useChartFullscreen({
    chartRef,
    title: '图表标题',
    onPrevious: handlePrevious,  // 可选
    onNext: handleNext,          // 可选
});

return (
    <Box ref={chartRef} sx={{...}}>
        <FullscreenEnterButton />
        <FullscreenExitButton />
        <FullscreenTitle />
        <NavigationButtons />

        <ResponsiveContainer>
            {/* Recharts 图表组件 */}
        </ResponsiveContainer>
    </Box>
);
```

### 4.3 图表曲线选择功能

**强制要求**：对于需要用户交互式选择显示/隐藏图表曲线的场景，必须使用项目内置的可复用 Hook `useSelectableSeries`。

**位置**：`frontend/src/hooks/useSelectableSeries.tsx`

**使用示例**：

```tsx
type SeriesKey = 'series1' | 'series2' | 'series3';

const { seriesVisibility, handleLegendClick } = useSelectableSeries<SeriesKey>({
    series1: true,
    series2: true,
    series3: true,
});

<LineChart data={data}>
    <Legend onClick={handleLegendClick} />
    <Line dataKey="series1" hide={!seriesVisibility.series1} />
    <Line dataKey="series2" hide={!seriesVisibility.series2} />
    <Line dataKey="series3" hide={!seriesVisibility.series3} />
</LineChart>
```

---

## 5. 开发检查清单

在开发新页面或修改现有页面时，请使用以下检查清单确保符合规范：

### 页面结构
- [ ] 外层容器使用 `<Box sx={{ width: '100%' }}>`
- [ ] 页面标题使用 `Breadcrumbs`，样式为 `fontSize: '1.2rem', fontWeight: 600`
- [ ] 不使用 `Container` 或 `PageHeader` 组件

### 组件样式
- [ ] Tab 导航容器使用 `variant="outlined"`
- [ ] 图表/表格容器使用默认 Paper 样式（不指定 elevation）
- [ ] 数据卡片使用 `elevation={2}`（仅在仪表板式布局中）
- [ ] Grid 组件使用 `size` 属性（非 `xs`/`md` 属性）

### 响应式设计
- [ ] 使用移动端优先的响应式断点
- [ ] 图表支持横屏全屏功能（使用 `useChartFullscreen`）
- [ ] 图表曲线支持交互选择（使用 `useSelectableSeries`）

### 代码质量
- [ ] 组件命名使用 PascalCase
- [ ] 变量和函数使用 camelCase
- [ ] 添加必要的 TypeScript 类型定义
- [ ] 添加必要的注释说明

---

## 6. 参考示例

### 优秀示例页面

1. **LoadAnalysisPage** (`frontend/src/pages/LoadAnalysisPage.tsx`)
   - 标准的 Tab 式导航布局
   - 简洁的页面标题
   - 统一的容器结构

2. **MarketPriceAnalysisPage** (`frontend/src/pages/MarketPriceAnalysisPage.tsx`)
   - 与 LoadAnalysisPage 完全一致的风格
   - 标准的组件样式

3. **GridAgencyPricePage** (`frontend/src/pages/GridAgencyPricePage.tsx`)（已重构）
   - 仪表板式布局的标准实现
   - 数据卡片的合理使用
   - 图表和表格的标准容器

---

## 7. 常见错误

### ❌ 错误 1：使用 Container 组件

```tsx
// 错误
<Container maxWidth="xl">
    <PageHeader title="..." breadcrumbs={...} />
    {/* 内容 */}
</Container>
```

```tsx
// 正确
<Box sx={{ width: '100%' }}>
    <Breadcrumbs aria-label="breadcrumb" sx={{ mb: 2 }}>
        {/* 面包屑内容 */}
    </Breadcrumbs>
    {/* 内容 */}
</Box>
```

### ❌ 错误 2：使用 MUI v5 的 Grid 语法

```tsx
// 错误
<Grid item xs={12} md={6}>
    {/* 内容 */}
</Grid>
```

```tsx
// 正确
<Grid size={{ xs: 12, md: 6 }}>
    {/* 内容 */}
</Grid>
```

### ❌ 错误 3：不统一的 Paper 样式

```tsx
// 错误：图表容器使用了不必要的 elevation
<Paper sx={{ p: 2 }} elevation={3}>
    <LineChart ... />
</Paper>
```

```tsx
// 正确
<Paper sx={{ p: 2 }}>
    <LineChart ... />
</Paper>
```

---

## 8. 更新日志

- **2025-11-01**：初始版本，基于 LoadAnalysisPage、MarketPriceAnalysisPage、GridAgencyPricePage 三个模块总结
- 统一了页面标题、容器结构、Paper 样式规范
- 明确了 Tab 式导航和仪表板式布局的实现标准
- 强调了 MUI v7 Grid 组件的正确使用方法

---

**注意**：本规范是强制性的，所有新开发的页面和对现有页面的重构都必须遵循本规范。如果在特殊场景下需要偏离规范，必须在代码中添加详细注释说明原因，并在团队评审中讨论。
