# 零售合同管理模块业务需求

## 1. 模块概述

零售合同管理模块旨在提供对电力零售合同的全面管理能力，包括合同的创建、导入、查看、编辑、删除以及生命周期管理。本模块将与客户档案管理模块和零售套餐管理模块深度集成，确保数据的一致性和业务流程的顺畅。

## 2. 核心功能需求

### 2.1 合同数据字段

基于“导出订单.xlsx”文件，合同数据字段包括但不限于：

*   **合同编号 (Contract Number)**：合同的唯一标识符，可用mongodb生成的_id。
*   **套餐 (Package)**：关联零售套餐管理模块中的套餐名称。
*   **代理销售费模型 (Agency Sales Fee Model)**：描述合同所采用的定价模型。
*   **购买用户 (Purchasing User)**：关联客户档案管理模块中的客户。
*   **购买电量 (Purchasing Electricity Quantity)**：合同约定的总购买电量。
*   **购电开始月份 (Purchase Time - Start)**：合同生效的起始月份。
*   **购电结束月份 (Purchase Time - End)**：合同结束的终止月份。
*   **合同状态 (Contract Status)**：**虚拟字段**，根据购电开始和结束月份动态生成（待生效、生效、已过期）。
*   **创建人/创建时间 (Creator/Creation Time)**：记录合同创建者和创建时间。
*   **更新人/更新时间 (Updater/Update Time)**：记录合同最后更新者和更新时间。

### 2.2 合同CRUD操作

*   **创建 (Create)**：支持手动创建新合同，其状态根据购电开始和结束月份自动生成。
*   **查看 (Read)**：提供合同列表和合同详情视图，展示合同所有信息。
*   **编辑 (Update)**：**在合同未生效前（即状态为“待生效”）**，允许编辑和修改。
*   **删除 (Delete)**：**在合同未生效前（即状态为“待生效”）**，允许删除。

### 2.3 导入功能 (新增)

*   **数据导入**：支持从外部文件（如Excel）批量导入合同数据。


## 3. 合同生命周期与状态管理 (增强)

本模块将引入严格的合同状态管理机制，并根据合同的购买时间自动判断状态。

### 3.1 合同状态定义

合同状态为**虚拟字段**，根据购电开始和结束月份动态生成，分为以下几种：

*   **待生效 (Pending Activation)**：合同已创建或导入，但其“购电开始月份”尚未到来。此状态的合同允许编辑、修改和删除。
*   **生效 (Active)**：当前日期落在合同的“购电开始月份”和“购电结束月份”月份之间。此状态的合同只能查看。
*   **已过期 (Expired)**：当前日期已超过合同的“购电结束月份”月份。此状态的合同只能查看。

### 3.2 状态自动判断规则

系统应根据当前日期和合同的“购电开始月份”及“购电结束月份”月份，自动更新合同的状态。

*   **待生效**：如果当前月份 < “购电开始月份”。
*   **生效**：如果当前月份 >= “购电开始月份” 且 当前月份 <= “购电结束月份”。
*   **已过期**：如果当前月份 > “购电结束月份”。

### 3.3 操作权限控制

*   **待生效状态**：允许编辑、修改和删除。
*   **生效、已过期状态**：只能查看，不允许任何修改或删除操作。

## 4. 与现有模块集成

*   **零售套餐管理模块**：合同创建/编辑时，需从零售套餐管理模块中选择现有套餐。
*   **客户档案管理模块**：合同创建/编辑时，需从客户档案管理模块中选择现有客户。

## 5. 列表、搜索与筛选

*   提供合同列表视图，展示合同编号、套餐、定价模型、购买用户、购买电量、购买时间范围和合同状态等关键信息。
*   支持按套餐名称、购买用户、合同状态、购买时间范围等多种条件进行搜索和筛选。
*   支持分页功能。

## 6. 报表与导出

*   支持将合同数据导出为Excel等格式，用于进一步的分析和报表生成。

## 7. 用户界面（UI）与用户体验（UX）

*   **列表视图**：清晰、直观的合同列表展示。
*   **详情/编辑视图**：提供友好的表单界面，方便用户创建和管理合同。
    *   **卡片二内容**：此卡片将显示关联零售套餐的详细内容，包括是否绿电、定价模型和模型参数等。这些内容将从零售套餐模块中带入，并在编辑和详情页中只做展示，不能修改编辑。
*   **导入界面**：提供清晰的导入操作指引和导入结果反馈。
*   **响应式设计**：确保模块在不同设备（桌面、平板、移动）上均能提供良好的用户体验。
*   **用户反馈**：提供操作成功、失败、加载中等状态的明确反馈。

