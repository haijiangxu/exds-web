# é›¶å”®åˆåŒç®¡ç†æ¨¡å—å¼€å‘è§„åˆ’ï¼ˆå®Œæ•´ç‰ˆï¼‰

## é¡¹ç›®æ¦‚è¿°

åŸºäºã€Šé›¶å”®åˆåŒç®¡ç†æ¨¡å—è®¾è®¡æ–¹æ¡ˆï¼ˆå®Œæ•´ç‰ˆï¼‰ã€‹ï¼Œé‡‡ç”¨4ä¸ªä¼šè¯å®Œæˆé›¶å”®åˆåŒç®¡ç†æ¨¡å—çš„å¼€å‘ã€‚æœ¬æ¨¡å—å¿…é¡»ä¸é›¶å”®å¥—é¤ç®¡ç†ã€å®¢æˆ·æ¡£æ¡ˆç®¡ç†æ¨¡å—ä¿æŒé«˜åº¦ä¸€è‡´çš„ä»£ç æ¶æ„å’ŒæŠ€æœ¯å®ç°ã€‚

**æµ‹è¯•è´¦å·ä¿¡æ¯**ï¼š
- ç”¨æˆ·åï¼šadmin
- å¯†ç ï¼š!234qwer

**æ ¸å¿ƒåŸåˆ™**ï¼š
- âš ï¸ **ç¦æ­¢ä¾èµ–æ–‡æ¡£**ï¼šåœ¨æ¯ä¸ªä¼šè¯å¼€å§‹æ—¶ï¼Œå¿…é¡»å…ˆåˆ†æå‚è€ƒæ¨¡å—çš„å®é™…ä»£ç ï¼Œç†è§£å…¶å®ç°ç»†èŠ‚
- âš ï¸ **ä¿æŒä¸€è‡´æ€§**ï¼šå‰åç«¯ä»£ç æ¶æ„ã€å‘½åè§„èŒƒã€é”™è¯¯å¤„ç†ã€UIäº¤äº’å¿…é¡»ä¸å‚è€ƒæ¨¡å—å®Œå…¨ä¸€è‡´

---

## ä¼šè¯è§„åˆ’æ€»è§ˆ

| ä¼šè¯ | ä¸»è¦å†…å®¹ | é¢„è®¡å·¥æ—¶ | éªŒè¯é‡ç‚¹ |
|------|----------|----------|----------|
| ä¼šè¯1 | åç«¯åŸºç¡€æ¶æ„ + API | 2-3å°æ—¶ | APIåŸºç¡€åŠŸèƒ½æµ‹è¯• |
| ä¼šè¯2 | å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ | 2-3å°æ—¶ | Excel å¯¼å…¥å¯¼å‡ºæµ‹è¯• |
| ä¼šè¯3 | å‰ç«¯åˆ—è¡¨å’Œç¼–è¾‘åŠŸèƒ½ | 2-3å°æ—¶ | UIäº¤äº’å’Œæ•°æ®è”åŠ¨æµ‹è¯• |
| ä¼šè¯4 | å‰ç«¯è¯¦æƒ…å’Œå®Œå–„ | 2-3å°æ—¶ | ç«¯åˆ°ç«¯æµ‹è¯• |

---

## ä¼šè¯ 1ï¼šåç«¯åŸºç¡€æ¶æ„ + API éªŒè¯æµ‹è¯•

**ç›®æ ‡**ï¼šå®Œæˆåç«¯æ•°æ®æ¨¡å‹å’ŒåŸºç¡€ CRUD APIï¼Œå¹¶è¿›è¡ŒéªŒè¯æµ‹è¯•

### ç¬¬ä¸€æ­¥ï¼šåˆ†æå‚è€ƒæ¨¡å—ä»£ç  âš ï¸

**å¼ºåˆ¶è¦æ±‚**ï¼šåœ¨ç¼–å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œå¿…é¡»å…ˆå®Œæˆä»¥ä¸‹ä»£ç åˆ†æä»»åŠ¡ã€‚

#### 1.1 åˆ†æé›¶å”®å¥—é¤æ¨¡å—çš„åç«¯å®ç°

**å¿…è¯»æ–‡ä»¶**ï¼š
```
webapp/models/retail_package.py
webapp/api/v1_retail_packages.py
webapp/services/retail_package_service.py (å¦‚æœå­˜åœ¨)
```

**åˆ†æé‡ç‚¹**ï¼š
- [ ] Pydantic æ¨¡å‹çš„å®šä¹‰æ–¹å¼ï¼š
  - `BaseMongoModel` çš„ä½¿ç”¨
  - `PyObjectId` çš„å¤„ç†
  - å®¡è®¡å­—æ®µï¼ˆcreated_at, created_by ç­‰ï¼‰çš„å®šä¹‰
  - åµŒå¥—æ¨¡å‹çš„å®šä¹‰æ–¹å¼

- [ ] API è·¯ç”±çš„è®¾è®¡æ¨¡å¼ï¼š
  - è·¯ç”±å‰ç¼€å’Œå‘½åè§„èŒƒ
  - ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨ï¼ˆ`Depends(get_current_active_user)`ï¼‰
  - å“åº”çŠ¶æ€ç çš„è®¾ç½®ï¼ˆ201 Created, 204 No Contentç­‰ï¼‰
  - é”™è¯¯å¤„ç†å’Œ `HTTPException` çš„ä½¿ç”¨

- [ ] æ•°æ®åº“æ“ä½œæ¨¡å¼ï¼š
  - `DATABASE` å…¨å±€å®ä¾‹çš„ä½¿ç”¨æ–¹æ³•
  - é›†åˆæ“ä½œçš„æ ‡å‡†æ¨¡å¼
  - æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ã€åˆ é™¤çš„å®ç°æ–¹å¼
  - åˆ†é¡µæŸ¥è¯¢çš„å®ç°

- [ ] ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š
  - çŠ¶æ€æœºçš„å®ç°æ–¹å¼
  - æ•°æ®æ ¡éªŒé€»è¾‘
  - è™šæ‹Ÿå­—æ®µçš„è®¡ç®—æ–¹å¼

**è¾“å‡º**ï¼šåœ¨ç»ˆç«¯è¾“å‡ºåˆ†æç»“è®ºï¼Œä¾‹å¦‚ï¼š
```
âœ“ é›¶å”®å¥—é¤æ¨¡å—ä½¿ç”¨ BaseMongoModelï¼Œç»§æ‰¿è‡ª BaseModelï¼ŒåŒ…å« PyObjectId ç±»å‹çš„ id å­—æ®µ
âœ“ API è·¯ç”±ä½¿ç”¨ APIRouterï¼Œå‰ç¼€ä¸º /api/v1/retail-packages
âœ“ æ‰€æœ‰å—ä¿æŠ¤è·¯ç”±ä½¿ç”¨ Depends(get_current_active_user) è¿›è¡ŒJWTè®¤è¯
âœ“ æ•°æ®åº“æ“ä½œé€šè¿‡ DATABASE["retail_packages"] é›†åˆè¿›è¡Œ
âœ“ ... å…¶ä»–å‘ç°
```

#### 1.2 åˆ†æå®¢æˆ·æ¡£æ¡ˆæ¨¡å—çš„åç«¯å®ç°

**å¿…è¯»æ–‡ä»¶**ï¼š
```
webapp/models/customer.py
webapp/api/v1_customers.py
```

**åˆ†æé‡ç‚¹**ï¼š
- [ ] åµŒå¥—æ•°æ®æ¨¡å‹çš„å®šä¹‰æ–¹å¼
- [ ] åµŒå¥—èµ„æºçš„ API è®¾è®¡ï¼ˆå¦‚æœæœ‰æˆ·å·ã€è®¡é‡ç‚¹ç®¡ç†æ¥å£ï¼‰
- [ ] æ•°æ®å…³è”çš„å¤„ç†æ–¹å¼

### ç¬¬äºŒæ­¥ï¼šå¼€å‘ä»»åŠ¡

#### 2.1 åˆ›å»ºæ•°æ®æ¨¡å‹æ–‡ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`webapp/models/contract.py`

**åŒ…å«å†…å®¹**ï¼š
- `BaseMongoModel` åŸºç±»ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼Œå‚è€ƒé›¶å”®å¥—é¤æ¨¡å—åˆ›å»ºï¼‰
- `Contract` æ¨¡å‹ï¼šå®Œæ•´çš„åˆåŒæ•°æ®æ¨¡å‹
- `ContractCreate` æ¨¡å‹ï¼šåˆ›å»ºåˆåŒçš„è¾“å…¥æ¨¡å‹
- `ContractUpdate` æ¨¡å‹ï¼šæ›´æ–°åˆåŒçš„è¾“å…¥æ¨¡å‹
- `ContractListResponse` æ¨¡å‹ï¼šåˆ—è¡¨å“åº”æ¨¡å‹

**å…³é”®è¦æ±‚**ï¼š
```python
# å‚è€ƒé›¶å”®å¥—é¤æ¨¡å—çš„æ¨¡å‹å®šä¹‰æ–¹å¼
from pydantic import BaseModel, Field
from typing import Optional, List
from datetime import datetime
from bson import ObjectId

class PyObjectId(ObjectId):
    @classmethod
    def __get_validators__(cls):
        yield cls.validate

    @classmethod
    def validate(cls, v):
        if not ObjectId.is_valid(v):
            raise ValueError("Invalid objectid")
        return ObjectId(v)

    @classmethod
    def __get_pydantic_json_schema__(cls, field_schema):
        field_schema.update(type="string")

class BaseMongoModel(BaseModel):
    id: PyObjectId = Field(default_factory=PyObjectId, alias="_id")

    model_config = ConfigDict(
        populate_by_name=True,
        arbitrary_types_allowed=True,
        json_encoders={ObjectId: str}
    )

class ContractCreate(BaseModel):
    package_name: str = Field(..., min_length=1)
    package_id: str = Field(..., min_length=1)
    customer_name: str = Field(..., min_length=1)
    customer_id: str = Field(..., min_length=1)
    purchasing_electricity_quantity: float = Field(..., gt=0)
    purchase_start_month: datetime
    purchase_end_month: datetime

class Contract(BaseMongoModel, ContractCreate):
    # å®¡è®¡å­—æ®µï¼ˆå¿…é¡»éµå¾ªé¡¹ç›®è§„èŒƒï¼‰
    created_by: Optional[str] = None
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_by: Optional[str] = None
    updated_at: datetime = Field(default_factory=datetime.utcnow)

    # è™šæ‹Ÿå­—æ®µï¼ˆç”±åç«¯è®¡ç®—ï¼‰
    status: Optional[str] = None  # 'pending' | 'active' | 'expired'
```

#### 2.2 åˆ›å»º API è·¯ç”±æ–‡ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`webapp/api/v1_retail_contracts.py`

**åŒ…å«å†…å®¹**ï¼š
- æ ‡å‡† CRUD æ“ä½œï¼š
  - `GET /api/v1/retail-contracts` - è·å–åˆåŒåˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ã€åˆ†é¡µï¼‰
  - `POST /api/v1/retail-contracts` - åˆ›å»ºåˆåŒ
  - `GET /api/v1/retail-contracts/{id}` - è·å–åˆåŒè¯¦æƒ…
  - `PUT /api/v1/retail-contracts/{id}` - æ›´æ–°åˆåŒï¼ˆä»…å¾…ç”Ÿæ•ˆçŠ¶æ€ï¼‰
  - `DELETE /api/v1/retail-contracts/{id}` - åˆ é™¤åˆåŒï¼ˆä»…å¾…ç”Ÿæ•ˆçŠ¶æ€ï¼‰

**å…³é”®è¦æ±‚**ï¼š
- å‚è€ƒ `v1_retail_packages.py` çš„è·¯ç”±ç»“æ„å’Œå‘½åè§„èŒƒ
- æ‰€æœ‰è·¯ç”±å¿…é¡»ä½¿ç”¨ `Depends(get_current_active_user)` è¿›è¡Œ JWT è®¤è¯
- ä½¿ç”¨æ­£ç¡®çš„å“åº”çŠ¶æ€ç ï¼ˆ201 Created, 204 No Content ç­‰ï¼‰
- å®ç°è™šæ‹ŸçŠ¶æ€å­—æ®µçš„è®¡ç®—é€»è¾‘ï¼š
  ```python
  def calculate_contract_status(purchase_start_month: datetime, purchase_end_month: datetime) -> str:
      """è®¡ç®—åˆåŒçŠ¶æ€ï¼ˆè™šæ‹Ÿå­—æ®µï¼‰"""
      from datetime import datetime
      from dateutil.relativedelta import relativedelta

      now = datetime.utcnow()
      current_month = datetime(now.year, now.month, 1)
      start_month = datetime(purchase_start_month.year, purchase_start_month.month, 1)
      end_month = datetime(purchase_end_month.year, purchase_end_month.month, 1)

      if current_month < start_month:
          return "pending"
      elif current_month > end_month:
          return "expired"
      else:
          return "active"
  ```

#### 2.3 æ›´æ–°ä¸»è·¯ç”±

**æ–‡ä»¶ä½ç½®**ï¼š`webapp/api/v1.py`

**ä¿®æ”¹å†…å®¹**ï¼š
```python
from webapp.api import v1_retail_contracts

# æ³¨å†ŒåˆåŒç®¡ç†è·¯ç”±
router.include_router(v1_retail_contracts.router)
```

#### 2.4 æ•°æ®åº“ç´¢å¼•åˆ›å»º

**åˆ›å»ºè„šæœ¬**ï¼š`scripts/create_contract_indexes.py`

```python
from webapp.tools.mongo import DATABASE

def create_indexes():
    """åˆ›å»ºåˆåŒé›†åˆçš„ç´¢å¼•"""
    collection = DATABASE["retail_contracts"]

    # ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
    collection.create_index("package_name")
    collection.create_index("customer_name")
    collection.create_index("purchase_start_month")
    collection.create_index("purchase_end_month")

    # å¤åˆç´¢å¼•ï¼ˆä¼˜åŒ–ç­›é€‰æŸ¥è¯¢ï¼‰
    collection.create_index([
        ("package_name", 1),
        ("purchase_start_month", -1)
    ])

    print("âœ“ åˆåŒé›†åˆç´¢å¼•åˆ›å»ºå®Œæˆ")

if __name__ == "__main__":
    create_indexes()
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æµ‹è¯•

#### 3.1 å¯åŠ¨åç«¯æœåŠ¡

**é‡è¦**ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–åç«¯æœåŠ¡å™¨ç®¡ç†æµç¨‹ï¼ˆå‚è€ƒ `CLAUDE.md`ï¼‰ï¼š

```bash
# å¯åŠ¨åç«¯æœåŠ¡å™¨ï¼ˆåå°è¿è¡Œï¼Œæ—¥å¿—é‡å®šå‘ï¼‰
Start-Process uvicorn -ArgumentList "webapp.main:app", "--reload", "--host", "0.0.0.0", "--port", "8005" -NoNewWindow -RedirectStandardOutput "d:\Gitworks\exds-web\tmp\uvicorn.out.log" -RedirectStandardError "d:\Gitworks\exds-web\tmp\uvicorn.err.log"
```

**ç›‘æ§æ—¥å¿—**ï¼š
```bash
# æ£€æŸ¥åç«¯å¯åŠ¨çŠ¶æ€
cat d:\Gitworks\exds-web\tmp\uvicorn.err.log
```

**é‡å¯æœåŠ¡å™¨**ï¼ˆå¦‚éœ€è¦ï¼‰ï¼š
```bash
# 1. æŸ¥æ‰¾è¿›ç¨‹ PID
netstat -aon | findstr ":8005"

# 2. ç»ˆæ­¢è¿›ç¨‹
taskkill /F /PID <PID>

# 3. é‡æ–°å¯åŠ¨ï¼ˆä½¿ç”¨ä¸Šé¢çš„ Start-Process å‘½ä»¤ï¼‰
```

#### 3.2 è·å– JWT Token

```bash
# è·å– Token
TOKEN=$(curl -s -X POST "http://127.0.0.1:8005/token" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=admin&password=!234qwer" | grep -o '"access_token":"[^"]*' | cut -d'"' -f4)

# Windows PowerShell ç‰ˆæœ¬
$response = Invoke-RestMethod -Uri "http://127.0.0.1:8005/token" -Method Post -Body @{username="admin";password="!234qwer"} -ContentType "application/x-www-form-urlencoded"
$TOKEN = $response.access_token
```

#### 3.3 API åŠŸèƒ½æµ‹è¯•

**æµ‹è¯• 1ï¼šåˆ›å»ºåˆåŒ**

```bash
# é¦–å…ˆè·å–ä¸€ä¸ªå·²ç”Ÿæ•ˆçš„å¥—é¤ ID å’Œä¸€ä¸ªæ­£å¸¸çŠ¶æ€çš„å®¢æˆ· ID
curl -X GET "http://127.0.0.1:8005/api/v1/retail-packages?status=active" \
     -H "Authorization: Bearer $TOKEN"

curl -X GET "http://127.0.0.1:8005/api/v1/customers?status=active" \
     -H "Authorization: Bearer $TOKEN"

# åˆ›å»ºåˆåŒ
curl -X POST "http://127.0.0.1:8005/api/v1/retail-contracts" \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "package_name": "2024å¹´å•†ä¸šå°–å³°å¹³è°·å¥—é¤",
       "package_id": "<ä»ä¸Šé¢è·å–çš„å¥—é¤ID>",
       "customer_name": "ä¸°åŸè¶…èƒœå¡‘ä¸šæœ‰é™å…¬å¸",
       "customer_id": "<ä»ä¸Šé¢è·å–çš„å®¢æˆ·ID>",
       "purchasing_electricity_quantity": 100000,
       "purchase_start_month": "2024-01-01T00:00:00Z",
       "purchase_end_month": "2024-12-01T00:00:00Z"
     }'
```

**æµ‹è¯• 2ï¼šè·å–åˆåŒåˆ—è¡¨**

```bash
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts" \
     -H "Authorization: Bearer $TOKEN"
```

**æµ‹è¯• 3ï¼šç­›é€‰å’Œåˆ†é¡µ**

```bash
# æŒ‰å¥—é¤åç§°ç­›é€‰
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts?package_name=å•†ä¸š" \
     -H "Authorization: Bearer $TOKEN"

# æŒ‰çŠ¶æ€ç­›é€‰
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts?status=pending" \
     -H "Authorization: Bearer $TOKEN"

# åˆ†é¡µæŸ¥è¯¢
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts?page=1&page_size=10" \
     -H "Authorization: Bearer $TOKEN"
```

**æµ‹è¯• 4ï¼šè·å–åˆåŒè¯¦æƒ…**

```bash
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts/{contract_id}" \
     -H "Authorization: Bearer $TOKEN"
```

**æµ‹è¯• 5ï¼šæ›´æ–°åˆåŒ**

```bash
# æ›´æ–°å¾…ç”Ÿæ•ˆçŠ¶æ€çš„åˆåŒï¼ˆåº”æˆåŠŸï¼‰
curl -X PUT "http://127.0.0.1:8005/api/v1/retail-contracts/{contract_id}" \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "package_name": "2024å¹´å•†ä¸šå°–å³°å¹³è°·å¥—é¤ï¼ˆå·²æ›´æ–°ï¼‰",
       "package_id": "<å¥—é¤ID>",
       "customer_name": "ä¸°åŸè¶…èƒœå¡‘ä¸šæœ‰é™å…¬å¸",
       "customer_id": "<å®¢æˆ·ID>",
       "purchasing_electricity_quantity": 150000,
       "purchase_start_month": "2024-02-01T00:00:00Z",
       "purchase_end_month": "2024-12-01T00:00:00Z"
     }'

# å°è¯•æ›´æ–°å·²ç”Ÿæ•ˆçš„åˆåŒï¼ˆåº”è¿”å› 400 é”™è¯¯ï¼‰
# åˆ›å»ºä¸€ä¸ªè´­ç”µå¼€å§‹æœˆä»½ä¸ºè¿‡å»æœˆä»½çš„åˆåŒï¼Œå…¶çŠ¶æ€åº”ä¸º 'active'
# ç„¶åå°è¯•æ›´æ–°ï¼ŒéªŒè¯æ˜¯å¦è¿”å›é”™è¯¯
```

**æµ‹è¯• 6ï¼šåˆ é™¤åˆåŒ**

```bash
# åˆ é™¤å¾…ç”Ÿæ•ˆçŠ¶æ€çš„åˆåŒï¼ˆåº”æˆåŠŸï¼‰
curl -X DELETE "http://127.0.0.1:8005/api/v1/retail-contracts/{contract_id}" \
     -H "Authorization: Bearer $TOKEN"

# å°è¯•åˆ é™¤å·²ç”Ÿæ•ˆçš„åˆåŒï¼ˆåº”è¿”å› 400 é”™è¯¯ï¼‰
```

#### 3.4 è®¿é—® API æ–‡æ¡£

- æµè§ˆå™¨è®¿é—®ï¼šhttp://127.0.0.1:8005/docs
- æµ‹è¯•æ‰€æœ‰ API ç«¯ç‚¹çš„äº¤äº’å¼æ–‡æ¡£
- éªŒè¯è¯·æ±‚/å“åº”çš„æ•°æ®ç»“æ„

#### 3.5 æ•°æ®åº“éªŒè¯

ä½¿ç”¨ MongoDB Compass æˆ– mongoshï¼š

```bash
# è¿æ¥æ•°æ®åº“
mongosh "mongodb://localhost:27017/exds"

# æŸ¥çœ‹é›†åˆ
show collections

# æŸ¥çœ‹åˆåŒæ•°æ®
db.retail_contracts.find().pretty()

# éªŒè¯ç´¢å¼•
db.retail_contracts.getIndexes()

# æµ‹è¯•çŠ¶æ€è®¡ç®—
db.retail_contracts.find({
  purchase_start_month: { $lte: new Date() },
  purchase_end_month: { $gte: new Date() }
})
```

### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰ CRUD API æ­£å¸¸å·¥ä½œ
- [ ] JWT è®¤è¯é›†æˆæ­£å¸¸
- [ ] è™šæ‹ŸçŠ¶æ€å­—æ®µè®¡ç®—æ­£ç¡®
- [ ] çŠ¶æ€æœºæƒé™æ§åˆ¶æœ‰æ•ˆï¼ˆå¾…ç”Ÿæ•ˆå¯ç¼–è¾‘åˆ é™¤ï¼Œå·²ç”Ÿæ•ˆ/å·²è¿‡æœŸä¸å¯ï¼‰
- [ ] åˆ†é¡µå’Œç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®åº“ç´¢å¼•åˆ›å»ºæˆåŠŸ
- [ ] API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆä¸”å‡†ç¡®
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„ï¼ˆ400/401/404/500ï¼‰
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼ˆPEP 8ã€ç±»å‹æç¤ºã€å‘½åè§„èŒƒï¼‰

---

## ä¼šè¯ 2ï¼šå¯¼å…¥å¯¼å‡ºåŠŸèƒ½

**ç›®æ ‡**ï¼šå®ç° Excel å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ï¼Œå¹¶è¿›è¡ŒéªŒè¯æµ‹è¯•

### ç¬¬ä¸€æ­¥ï¼šåˆ†æå‚è€ƒæ¨¡å—ä»£ç  âš ï¸

#### 2.1 æ£€æŸ¥ç°æœ‰å¯¼å…¥å¯¼å‡ºå®ç°

**æ£€æŸ¥æ–‡ä»¶**ï¼š
```
# æ£€æŸ¥é›¶å”®å¥—é¤æ¨¡å—æ˜¯å¦æœ‰å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
webapp/api/v1_retail_packages.py

# æ£€æŸ¥å®¢æˆ·æ¡£æ¡ˆæ¨¡å—æ˜¯å¦æœ‰å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
webapp/api/v1_customers.py

# æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦æœ‰é€šç”¨çš„Excelå¤„ç†å·¥å…·
webapp/utils/excel_utils.py (å¯èƒ½å­˜åœ¨)
```

**åˆ†æé‡ç‚¹**ï¼š
- [ ] Excel æ–‡ä»¶ä¸Šä¼ çš„å¤„ç†æ–¹å¼ï¼ˆ`UploadFile` çš„ä½¿ç”¨ï¼‰
- [ ] Excel è§£æåº“çš„é€‰æ‹©ï¼ˆpandas / openpyxlï¼‰
- [ ] æ•°æ®æ ¡éªŒçš„å®ç°æ¨¡å¼
- [ ] é”™è¯¯ä¿¡æ¯çš„æ”¶é›†å’Œè¿”å›æ–¹å¼
- [ ] å¯¼å‡ºåŠŸèƒ½çš„æ–‡ä»¶æµå¤„ç†

### ç¬¬äºŒæ­¥ï¼šå¼€å‘ä»»åŠ¡

#### 2.1 å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰

```bash
# æ£€æŸ¥ requirements.txt æ˜¯å¦åŒ…å«ä»¥ä¸‹åº“
pip install pandas openpyxl python-multipart
```

#### 2.2 åˆ›å»ºå¯¼å…¥åŠŸèƒ½

**åœ¨ `v1_retail_contracts.py` ä¸­æ·»åŠ **ï¼š

```python
from fastapi import UploadFile, File
import pandas as pd
from typing import List, Dict, Any
from datetime import datetime

@router.post("/import", summary="å¯¼å…¥åˆåŒæ•°æ®")
async def import_contracts(
    file: UploadFile = File(...),
    current_user: User = Depends(get_current_active_user)
):
    """
    å¯¼å…¥åˆåŒæ•°æ®ï¼ˆåŒæ­¥æ–¹æ¡ˆï¼‰

    Excelæ–‡ä»¶æ ¼å¼è¦æ±‚ï¼š
    - åˆ—åï¼šå¥—é¤åç§°, å®¢æˆ·åç§°, è´­ä¹°ç”µé‡, è´­ç”µå¼€å§‹æœˆä»½, è´­ç”µç»“æŸæœˆä»½
    - å¥—é¤åç§°å’Œå®¢æˆ·åç§°å¿…é¡»å­˜åœ¨äºç³»ç»Ÿä¸­
    - æ—¥æœŸæ ¼å¼ï¼šYYYY-MM æˆ– YYYY-MM-DD
    """
    try:
        # 1. è¯»å– Excel æ–‡ä»¶
        contents = await file.read()
        df = pd.read_excel(io.BytesIO(contents))

        # 2. éªŒè¯æ–‡ä»¶ç»“æ„
        required_columns = ['å¥—é¤åç§°', 'å®¢æˆ·åç§°', 'è´­ä¹°ç”µé‡', 'è´­ç”µå¼€å§‹æœˆä»½', 'è´­ç”µç»“æŸæœˆä»½']
        missing_columns = [col for col in required_columns if col not in df.columns]
        if missing_columns:
            raise HTTPException(
                status_code=400,
                detail=f"ç¼ºå°‘å¿…éœ€åˆ—ï¼š{', '.join(missing_columns)}"
            )

        # 3. é€è¡Œæ ¡éªŒå’Œå¯¼å…¥
        success_count = 0
        failed_count = 0
        errors = []

        for index, row in df.iterrows():
            try:
                # æ•°æ®æ ¡éªŒ
                errors_in_row = validate_contract_row(row, index + 2)  # +2 å› ä¸º Excel ä»1å¼€å§‹ï¼Œä¸”æœ‰è¡¨å¤´

                if errors_in_row:
                    errors.extend(errors_in_row)
                    failed_count += 1
                    continue

                # æ’å…¥æ•°æ®åº“
                contract_data = {
                    "package_name": row['å¥—é¤åç§°'],
                    "package_id": ...,  # ä»é›¶å”®å¥—é¤æ¨¡å—æŸ¥è¯¢
                    "customer_name": row['å®¢æˆ·åç§°'],
                    "customer_id": ...,  # ä»å®¢æˆ·æ¡£æ¡ˆæ¨¡å—æŸ¥è¯¢
                    "purchasing_electricity_quantity": float(row['è´­ä¹°ç”µé‡']),
                    "purchase_start_month": parse_month(row['è´­ç”µå¼€å§‹æœˆä»½']),
                    "purchase_end_month": parse_month(row['è´­ç”µç»“æŸæœˆä»½']),
                    "created_by": current_user.username,
                    "created_at": datetime.utcnow(),
                    "updated_by": current_user.username,
                    "updated_at": datetime.utcnow()
                }

                DATABASE["retail_contracts"].insert_one(contract_data)
                success_count += 1

            except Exception as e:
                errors.append({
                    "row": index + 2,
                    "field": "general",
                    "message": str(e)
                })
                failed_count += 1

        # 4. è¿”å›ç»“æœ
        return {
            "total": len(df),
            "success": success_count,
            "failed": failed_count,
            "errors": errors
        }

    except Exception as e:
        raise HTTPException(status_code=400, detail=f"å¯¼å…¥å¤±è´¥ï¼š{str(e)}")

def validate_contract_row(row: pd.Series, row_number: int) -> List[Dict[str, Any]]:
    """æ ¡éªŒå•è¡Œæ•°æ®"""
    errors = []

    # å¿…å¡«é¡¹æ ¡éªŒ
    if pd.isna(row['å¥—é¤åç§°']):
        errors.append({"row": row_number, "field": "å¥—é¤åç§°", "message": "ä¸èƒ½ä¸ºç©º"})

    if pd.isna(row['å®¢æˆ·åç§°']):
        errors.append({"row": row_number, "field": "å®¢æˆ·åç§°", "message": "ä¸èƒ½ä¸ºç©º"})

    # æ•°å­—æ ¼å¼æ ¡éªŒ
    try:
        quantity = float(row['è´­ä¹°ç”µé‡'])
        if quantity <= 0:
            errors.append({"row": row_number, "field": "è´­ä¹°ç”µé‡", "message": "å¿…é¡»å¤§äº0"})
    except:
        errors.append({"row": row_number, "field": "è´­ä¹°ç”µé‡", "message": "æ ¼å¼é”™è¯¯"})

    # å¥—é¤å­˜åœ¨æ€§æ ¡éªŒ
    package = DATABASE["retail_packages"].find_one({
        "package_name": row['å¥—é¤åç§°'],
        "status": "active"
    })
    if not package:
        errors.append({"row": row_number, "field": "å¥—é¤åç§°", "message": "å¥—é¤ä¸å­˜åœ¨æˆ–æœªç”Ÿæ•ˆ"})

    # å®¢æˆ·å­˜åœ¨æ€§æ ¡éªŒ
    customer = DATABASE["customers"].find_one({
        "user_name": row['å®¢æˆ·åç§°'],
        "status": "active"
    })
    if not customer:
        errors.append({"row": row_number, "field": "å®¢æˆ·åç§°", "message": "å®¢æˆ·ä¸å­˜åœ¨æˆ–éæ­£å¸¸çŠ¶æ€"})

    # æ—¶é—´é€»è¾‘æ ¡éªŒ
    try:
        start_month = parse_month(row['è´­ç”µå¼€å§‹æœˆä»½'])
        end_month = parse_month(row['è´­ç”µç»“æŸæœˆä»½'])
        if end_month < start_month:
            errors.append({"row": row_number, "field": "è´­ç”µæœˆä»½", "message": "ç»“æŸæœˆä»½ä¸èƒ½æ—©äºå¼€å§‹æœˆä»½"})
    except:
        errors.append({"row": row_number, "field": "è´­ç”µæœˆä»½", "message": "æ—¥æœŸæ ¼å¼é”™è¯¯"})

    return errors

def parse_month(date_str: str) -> datetime:
    """è§£ææœˆä»½å­—ç¬¦ä¸²ä¸º datetimeï¼ˆæ¯æœˆ1å·ï¼‰"""
    # æ”¯æŒå¤šç§æ ¼å¼ï¼šYYYY-MM, YYYY-MM-DD, YYYY/MM ç­‰
    # å‚è€ƒå®¢æˆ·æ¡£æ¡ˆæˆ–é›¶å”®å¥—é¤æ¨¡å—çš„æ—¥æœŸå¤„ç†æ–¹å¼
    pass
```

#### 2.3 åˆ›å»ºå¯¼å‡ºåŠŸèƒ½

```python
from fastapi.responses import StreamingResponse
import io

@router.get("/export", summary="å¯¼å‡ºåˆåŒæ•°æ®")
async def export_contracts(
    package_name: Optional[str] = None,
    customer_name: Optional[str] = None,
    status: Optional[str] = None,
    current_user: User = Depends(get_current_active_user)
):
    """å¯¼å‡ºåˆåŒæ•°æ®ä¸ºExcelæ–‡ä»¶"""

    # 1. æ„å»ºæŸ¥è¯¢æ¡ä»¶
    query = {}
    if package_name:
        query["package_name"] = {"$regex": package_name, "$options": "i"}
    if customer_name:
        query["customer_name"] = {"$regex": customer_name, "$options": "i"}

    # 2. æŸ¥è¯¢æ•°æ®
    contracts = list(DATABASE["retail_contracts"].find(query))

    # 3. è®¡ç®—è™šæ‹ŸçŠ¶æ€å¹¶æ·»åŠ åˆ°æ•°æ®ä¸­
    for contract in contracts:
        contract["status"] = calculate_contract_status(
            contract["purchase_start_month"],
            contract["purchase_end_month"]
        )

    # 4. è¿‡æ»¤çŠ¶æ€
    if status and status != "all":
        contracts = [c for c in contracts if c["status"] == status]

    # 5. è½¬æ¢ä¸º DataFrame
    df = pd.DataFrame(contracts)

    # é€‰æ‹©è¦å¯¼å‡ºçš„åˆ—
    columns_to_export = [
        "_id", "package_name", "customer_name",
        "purchasing_electricity_quantity",
        "purchase_start_month", "purchase_end_month",
        "status", "created_at", "updated_at"
    ]
    df = df[columns_to_export]

    # é‡å‘½ååˆ—ä¸ºä¸­æ–‡
    df.columns = [
        "åˆåŒç¼–å·", "å¥—é¤åç§°", "å®¢æˆ·åç§°",
        "è´­ä¹°ç”µé‡", "è´­ç”µå¼€å§‹æœˆä»½", "è´­ç”µç»“æŸæœˆä»½",
        "çŠ¶æ€", "åˆ›å»ºæ—¶é—´", "æ›´æ–°æ—¶é—´"
    ]

    # 6. ç”Ÿæˆ Excel æ–‡ä»¶
    output = io.BytesIO()
    with pd.ExcelWriter(output, engine='openpyxl') as writer:
        df.to_excel(writer, index=False, sheet_name='åˆåŒæ•°æ®')
    output.seek(0)

    # 7. è¿”å›æ–‡ä»¶æµ
    filename = f"contracts_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx"

    return StreamingResponse(
        output,
        media_type="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        headers={"Content-Disposition": f"attachment; filename={filename}"}
    )
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æµ‹è¯•

#### 3.1 å‡†å¤‡æµ‹è¯•æ•°æ®

åˆ›å»ºæµ‹è¯•ç”¨çš„ Excel æ–‡ä»¶ï¼š`test_contracts.xlsx`

| å¥—é¤åç§° | å®¢æˆ·åç§° | è´­ä¹°ç”µé‡ | è´­ç”µå¼€å§‹æœˆä»½ | è´­ç”µç»“æŸæœˆä»½ |
|---------|---------|---------|-------------|-------------|
| 2024å¹´å•†ä¸šå°–å³°å¹³è°·å¥—é¤ | ä¸°åŸè¶…èƒœå¡‘ä¸šæœ‰é™å…¬å¸ | 100000 | 2024-01 | 2024-12 |
| é”™è¯¯å¥—é¤åç§° | é”™è¯¯å®¢æˆ·åç§° | -1000 | 2024-13 | 2024-10 |

#### 3.2 æµ‹è¯•å¯¼å…¥åŠŸèƒ½

```bash
# å¯¼å…¥åˆåŒæ•°æ®
curl -X POST "http://127.0.0.1:8005/api/v1/retail-contracts/import" \
     -H "Authorization: Bearer $TOKEN" \
     -F "file=@test_contracts.xlsx"
```

**éªŒè¯**ï¼š
- [ ] æˆåŠŸå¯¼å…¥çš„åˆåŒæ•°é‡æ­£ç¡®
- [ ] å¤±è´¥è®°å½•çš„é”™è¯¯ä¿¡æ¯è¯¦ç»†ä¸”å‡†ç¡®
- [ ] éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥çš„åœºæ™¯å¤„ç†æ­£ç¡®

#### 3.3 æµ‹è¯•å¯¼å‡ºåŠŸèƒ½

```bash
# å¯¼å‡ºæ‰€æœ‰åˆåŒ
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts/export" \
     -H "Authorization: Bearer $TOKEN" \
     -o contracts_export.xlsx

# æŒ‰æ¡ä»¶å¯¼å‡º
curl -X GET "http://127.0.0.1:8005/api/v1/retail-contracts/export?status=active" \
     -H "Authorization: Bearer $TOKEN" \
     -o contracts_active.xlsx
```

**éªŒè¯**ï¼š
- [ ] å¯¼å‡ºçš„ Excel æ–‡ä»¶æ ¼å¼æ­£ç¡®
- [ ] æ•°æ®å®Œæ•´ä¸”å‡†ç¡®
- [ ] ä¸­æ–‡åˆ—åæ˜¾ç¤ºæ­£ç¡®
- [ ] ç­›é€‰æ¡ä»¶æœ‰æ•ˆ

### éªŒæ”¶æ ‡å‡†

- [ ] å¯¼å…¥åŠŸèƒ½æ”¯æŒæ ‡å‡† Excel æ ¼å¼ï¼ˆ.xlsxï¼‰
- [ ] æ•°æ®æ ¡éªŒå®Œæ•´ï¼ˆå¿…å¡«é¡¹ã€æ ¼å¼ã€å…³è”æ•°æ®ã€ä¸šåŠ¡é€»è¾‘ï¼‰
- [ ] é”™è¯¯ä¿¡æ¯è¯¦ç»†ä¸”æ˜“äºç†è§£ï¼ˆåŒ…å«è¡Œå·ã€å­—æ®µã€é”™è¯¯åŸå› ï¼‰
- [ ] å¯¼å‡ºåŠŸèƒ½æ”¯æŒç­›é€‰æ¡ä»¶
- [ ] å¯¼å‡ºçš„ Excel æ–‡ä»¶æ ¼å¼è§„èŒƒ
- [ ] éƒ¨åˆ†æˆåŠŸåœºæ™¯å¤„ç†æ­£ç¡®
- [ ] å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½å¯æ¥å—ï¼ˆæµ‹è¯• 100+ è¡Œæ•°æ®ï¼‰

---

## ä¼šè¯ 3ï¼šå‰ç«¯åˆ—è¡¨å’Œç¼–è¾‘åŠŸèƒ½

**ç›®æ ‡**ï¼šå®Œæˆå‰ç«¯åˆåŒåˆ—è¡¨é¡µé¢å’Œç¼–è¾‘å¯¹è¯æ¡†ï¼Œå¹¶è¿›è¡ŒéªŒè¯æµ‹è¯•

### ç¬¬ä¸€æ­¥ï¼šåˆ†æå‚è€ƒæ¨¡å—ä»£ç  âš ï¸

#### 3.1 åˆ†æé›¶å”®å¥—é¤æ¨¡å—çš„å‰ç«¯å®ç°

**å¿…è¯»æ–‡ä»¶**ï¼š
```
frontend/src/pages/RetailPackagePage.tsx
frontend/src/components/PackageEditorDialog.tsx
frontend/src/api/retail-packages.ts
```

**åˆ†æé‡ç‚¹**ï¼š
- [ ] é¡µé¢ç»“æ„å’Œå¸ƒå±€ï¼š
  - å¤–å±‚å®¹å™¨ï¼ˆ`<Box sx={{ width: '100%' }}>`)
  - é¢åŒ…å±‘å¯¼èˆª
  - åŒå¡ç‰‡å¸ƒå±€ï¼ˆæŸ¥è¯¢å¡ç‰‡ + åˆ—è¡¨å¡ç‰‡ï¼‰

- [ ] æŸ¥è¯¢åŒºåŸŸï¼š
  - ç­›é€‰æ¡ä»¶çš„çŠ¶æ€ç®¡ç†
  - æŸ¥è¯¢æäº¤é€»è¾‘
  - é‡ç½®æŒ‰é’®å®ç°

- [ ] åˆ—è¡¨æ¸²æŸ“ï¼š
  - è¡¨æ ¼çš„å“åº”å¼è®¾è®¡
  - åˆ†é¡µç»„ä»¶çš„ä½¿ç”¨
  - `renderTableActions` å‡½æ•°çš„å®ç°
  - çŠ¶æ€æ§åˆ¶æŒ‰é’®æ˜¾ç¤º/ç¦ç”¨çš„é€»è¾‘

- [ ] ç¼–è¾‘å¯¹è¯æ¡†ï¼š
  - Dialog çš„é…ç½®ï¼ˆmaxWidth, fullScreen, disableEnforceFocusï¼‰
  - React Hook Form çš„é›†æˆ
  - è¾…åŠ©æ¸²æŸ“å‡½æ•°çš„ç»„ç»‡
  - è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†
  - æäº¤é€»è¾‘

#### 3.2 åˆ†æ API å®¢æˆ·ç«¯å®ç°

**åˆ†æ `frontend/src/api/retail-packages.ts`**ï¼š
- [ ] API æ–¹æ³•çš„å‘½åè§„èŒƒ
- [ ] ç±»å‹å®šä¹‰çš„æ–¹å¼
- [ ] é”™è¯¯å¤„ç†æ¨¡å¼

### ç¬¬äºŒæ­¥ï¼šå¼€å‘ä»»åŠ¡

#### 2.1 åˆ›å»º API å®¢æˆ·ç«¯

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/api/retail-contracts.ts`

```typescript
import apiClient from './client';

export interface Contract {
  _id: string;
  package_name: string;
  package_id: string;
  customer_name: string;
  customer_id: string;
  purchasing_electricity_quantity: number;
  purchase_start_month: string;
  purchase_end_month: string;
  status: 'pending' | 'active' | 'expired';
  created_at: string;
  updated_at: string;
  created_by?: string;
  updated_by?: string;
}

export interface ContractListResponse {
  items: Contract[];
  total: number;
  page: number;
  page_size: number;
}

export const contractApi = {
  getList: (params?: any) =>
    apiClient.get<ContractListResponse>('/api/v1/retail-contracts', { params }),

  getById: (id: string) =>
    apiClient.get<Contract>(`/api/v1/retail-contracts/${id}`),

  create: (data: Partial<Contract>) =>
    apiClient.post<Contract>('/api/v1/retail-contracts', data),

  update: (id: string, data: Partial<Contract>) =>
    apiClient.put<Contract>(`/api/v1/retail-contracts/${id}`, data),

  delete: (id: string) =>
    apiClient.delete(`/api/v1/retail-contracts/${id}`),

  import: (file: File) => {
    const formData = new FormData();
    formData.append('file', file);
    return apiClient.post('/api/v1/retail-contracts/import', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    });
  },

  export: (params?: any) =>
    apiClient.get('/api/v1/retail-contracts/export', {
      params,
      responseType: 'blob'
    })
};
```

#### 2.2 åˆ›å»ºåˆåŒåˆ—è¡¨é¡µé¢

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/pages/RetailContractPage.tsx`

**å¼ºåˆ¶è¦æ±‚**ï¼š
- å‚è€ƒ `RetailPackagePage.tsx` çš„å®Œæ•´ç»“æ„
- å¤ç”¨æŸ¥è¯¢å¡ç‰‡å’Œåˆ—è¡¨å¡ç‰‡çš„æ ·å¼
- å®ç° `renderTableActions` å‡½æ•°ï¼Œæ ¹æ®çŠ¶æ€æ§åˆ¶æŒ‰é’®
- ä½¿ç”¨å“åº”å¼ Grid å¸ƒå±€ï¼ˆ`size` å±æ€§ï¼‰

**å…³é”®ä»£ç ç‰‡æ®µ**ï¼š
```tsx
// çŠ¶æ€ç®¡ç†
const [contracts, setContracts] = useState<Contract[]>([]);
const [loading, setLoading] = useState(false);
const [page, setPage] = useState(0);
const [pageSize, setPageSize] = useState(10);
const [total, setTotal] = useState(0);

// ç­›é€‰æ¡ä»¶
const [filters, setFilters] = useState({
  package_name: '',
  customer_name: '',
  status: 'all',
  start_month: null,
  end_month: null
});

// è·å–åˆåŒåˆ—è¡¨
const fetchContracts = async () => {
  setLoading(true);
  try {
    const response = await contractApi.getList({
      ...filters,
      page: page + 1,
      page_size: pageSize
    });
    setContracts(response.data.items);
    setTotal(response.data.total);
  } catch (error) {
    console.error('åŠ è½½åˆåŒåˆ—è¡¨å¤±è´¥', error);
  } finally {
    setLoading(false);
  }
};

// æ“ä½œæŒ‰é’®æ¸²æŸ“ï¼ˆæ ¹æ®çŠ¶æ€æ§åˆ¶ï¼‰
const renderTableActions = (contract: Contract) => (
  <Box sx={{ display: 'flex', gap: 1 }}>
    <Tooltip title="æŸ¥çœ‹">
      <IconButton onClick={() => handleView(contract)}>
        <VisibilityIcon />
      </IconButton>
    </Tooltip>

    {contract.status === 'pending' && (
      <>
        <Tooltip title="ç¼–è¾‘">
          <IconButton onClick={() => handleEdit(contract)}>
            <EditIcon />
          </IconButton>
        </Tooltip>

        <Tooltip title="åˆ é™¤">
          <IconButton onClick={() => handleDelete(contract)}>
            <DeleteIcon />
          </IconButton>
        </Tooltip>
      </>
    )}
  </Box>
);
```

#### 2.3 åˆ›å»ºåˆåŒç¼–è¾‘å¯¹è¯æ¡†

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/components/ContractEditorDialog.tsx`

**å¼ºåˆ¶è¦æ±‚**ï¼š
- å‚è€ƒ `PackageEditorDialog.tsx` çš„å®Œæ•´ç»“æ„
- ä½¿ç”¨ React Hook Form
- å®ç°è¾…åŠ©æ¸²æŸ“å‡½æ•°ï¼ˆ`renderBasicInfoSection`, `renderPackageContentSection`ï¼‰
- å¥—é¤å’Œå®¢æˆ·é€‰æ‹©ä½¿ç”¨ `Autocomplete` ç»„ä»¶
- é€‰æ‹©å¥—é¤åè‡ªåŠ¨åŠ è½½å¥—é¤è¯¦æƒ…

**å…³é”®ä»£ç ç‰‡æ®µ**ï¼š
```tsx
// è¡¨å•ç®¡ç†
const { control, handleSubmit, watch, setValue, formState: { errors } } = useForm<ContractFormData>();

// å¥—é¤é€‰æ‹©ååŠ è½½è¯¦æƒ…
const handlePackageSelect = async (packageId: string) => {
  try {
    const response = await apiClient.get(`/api/v1/retail-packages/${packageId}`);
    setSelectedPackage(response.data);
  } catch (error) {
    console.error('åŠ è½½å¥—é¤è¯¦æƒ…å¤±è´¥', error);
  }
};

// åŸºæœ¬ä¿¡æ¯å¡ç‰‡
const renderBasicInfoSection = () => (
  <Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mt: 2 }}>
    <Typography variant="h6" gutterBottom>åˆåŒåŸºæœ¬ä¿¡æ¯</Typography>

    <Grid container spacing={{ xs: 1, sm: 2 }}>
      <Grid size={{ xs: 12, md: 6 }}>
        <Controller
          name="package_name"
          control={control}
          rules={{ required: 'è¯·é€‰æ‹©å¥—é¤' }}
          render={({ field }) => (
            <Autocomplete
              {...field}
              options={packageOptions}
              getOptionLabel={(option) => option.package_name}
              onChange={(event, value) => {
                field.onChange(value?.package_name);
                if (value) handlePackageSelect(value._id);
              }}
              renderInput={(params) => (
                <TextField
                  {...params}
                  label="å¥—é¤åç§°"
                  required
                  error={!!errors.package_name}
                  helperText={errors.package_name?.message}
                />
              )}
            />
          )}
        />
      </Grid>

      {/* å…¶ä»–å­—æ®µ... */}
    </Grid>
  </Paper>
);

// å¥—é¤å†…å®¹å¡ç‰‡ï¼ˆåªè¯»å±•ç¤ºï¼‰
const renderPackageContentSection = () => (
  <Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mt: 2 }}>
    <Typography variant="h6" gutterBottom>å…³è”å¥—é¤å†…å®¹</Typography>

    {selectedPackage ? (
      <Grid container spacing={2}>
        <Grid size={{ xs: 12, sm: 6 }}>
          <Typography variant="body2" color="text.secondary">å¥—é¤ç±»å‹</Typography>
          <Typography variant="body1">
            {selectedPackage.package_type === 'time_based' ? 'åˆ†æ—¶æ®µ' : 'ä¸åˆ†æ—¶æ®µ'}
          </Typography>
        </Grid>

        {/* å…¶ä»–å­—æ®µ... */}
      </Grid>
    ) : (
      <Typography color="text.secondary">è¯·å…ˆé€‰æ‹©å¥—é¤</Typography>
    )}
  </Paper>
);
```

#### 2.4 æ›´æ–°è·¯ç”±é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/App.tsx`

```tsx
import RetailContractPage from './pages/RetailContractPage';

// åœ¨è·¯ç”±é…ç½®ä¸­æ·»åŠ 
<Route path="/retail-contracts" element={
  <ProtectedRoute>
    <RetailContractPage />
  </ProtectedRoute>
} />
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æµ‹è¯•

#### 3.1 å¯åŠ¨å‰ç«¯æœåŠ¡

**é‡è¦**ï¼šåœ¨åå°å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œå¹¶å°†æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼š

```bash
# Windows PowerShell
Start-Process npm -ArgumentList "start", "--prefix", "frontend" -NoNewWindow -RedirectStandardOutput "tmp\frontend_dev.log" -RedirectStandardError "tmp\frontend_dev.log"
```

**ç›‘æ§ç¼–è¯‘é”™è¯¯**ï¼š
```bash
# è¯»å–æ—¥å¿—æ–‡ä»¶
cat tmp\frontend_dev.log

# æˆ–è¿è¡Œæ„å»ºæ£€æŸ¥ç¼–è¯‘é”™è¯¯
npm run build --prefix frontend
```

#### 3.2 ä½¿ç”¨ Chrome DevTools è¿›è¡Œè°ƒè¯•

**é‡è¦**ï¼šé»˜è®¤ä½¿ç”¨ chrome-devtools MCP å·¥å…·è¿›è¡Œå‰ç«¯è°ƒè¯•ã€‚

```tsx
// 1. æ‰“å¼€å‰ç«¯åº”ç”¨
mcp__chrome-devtools__new_page({ url: 'http://localhost:3000' })

// 2. ç™»å½•
// å¡«å†™ç”¨æˆ·åå’Œå¯†ç è¡¨å•ï¼Œç‚¹å‡»ç™»å½•æŒ‰é’®

// 3. å¯¼èˆªåˆ°åˆåŒç®¡ç†é¡µé¢
mcp__chrome-devtools__click({ uid: 'åˆåŒç®¡ç†èœå•çš„UID' })

// 4. æµ‹è¯•é¡µé¢åŠŸèƒ½
mcp__chrome-devtools__take_snapshot()  // è·å–é¡µé¢å¿«ç…§

// 5. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
mcp__chrome-devtools__list_console_messages({ types: ['error'] })
```

#### 3.3 åŠŸèƒ½æµ‹è¯•æ¸…å•

**åˆ—è¡¨é¡µé¢æµ‹è¯•**ï¼š
- [ ] é¡µé¢åŠ è½½æ­£å¸¸ï¼Œé¢åŒ…å±‘å¯¼èˆªæ˜¾ç¤ºæ­£ç¡®
- [ ] åˆåŒåˆ—è¡¨æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] ç­›é€‰åŠŸèƒ½ï¼šæŒ‰å¥—é¤åç§°ã€å®¢æˆ·åç§°ã€çŠ¶æ€ç­›é€‰æœ‰æ•ˆ
- [ ] åˆ†é¡µåŠŸèƒ½ï¼šåˆ‡æ¢é¡µç ã€è°ƒæ•´æ¯é¡µæ•°é‡æ­£å¸¸
- [ ] åˆ·æ–°å’Œé‡ç½®æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯å¸ƒå±€æ­£ç¡®

**ç¼–è¾‘å¯¹è¯æ¡†æµ‹è¯•**ï¼š
- [ ] ç‚¹å‡»"æ–°å¢åˆåŒ"æŒ‰é’®ï¼Œå¯¹è¯æ¡†æ‰“å¼€
- [ ] å¥—é¤é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨åŠ è½½æ­£å¸¸ï¼ˆä»…æ˜¾ç¤ºå·²ç”Ÿæ•ˆå¥—é¤ï¼‰
- [ ] å®¢æˆ·é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨åŠ è½½æ­£å¸¸ï¼ˆä»…æ˜¾ç¤ºæ­£å¸¸çŠ¶æ€å®¢æˆ·ï¼‰
- [ ] é€‰æ‹©å¥—é¤åï¼Œå¥—é¤å†…å®¹å¡ç‰‡è‡ªåŠ¨å±•ç¤ºè¯¦æƒ…
- [ ] è¡¨å•éªŒè¯ï¼šå¿…å¡«é¡¹æç¤ºã€è´­ä¹°ç”µé‡>0ã€ç»“æŸæœˆä»½>=å¼€å§‹æœˆä»½
- [ ] ä¿å­˜æˆåŠŸåæ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶å…³é—­å¯¹è¯æ¡†
- [ ] ç¼–è¾‘ç°æœ‰åˆåŒåŠŸèƒ½æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯å…¨å±æ¨¡å¼æ­£å¸¸

**æ“ä½œæŒ‰é’®æµ‹è¯•**ï¼š
- [ ] å¾…ç”Ÿæ•ˆçŠ¶æ€çš„åˆåŒæ˜¾ç¤º"æŸ¥çœ‹"ã€"ç¼–è¾‘"ã€"åˆ é™¤"æŒ‰é’®
- [ ] å·²ç”Ÿæ•ˆçŠ¶æ€çš„åˆåŒä»…æ˜¾ç¤º"æŸ¥çœ‹"æŒ‰é’®
- [ ] å·²è¿‡æœŸçŠ¶æ€çš„åˆåŒä»…æ˜¾ç¤º"æŸ¥çœ‹"æŒ‰é’®
- [ ] åˆ é™¤æ“ä½œæœ‰äºŒæ¬¡ç¡®è®¤å¯¹è¯æ¡†

### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰åˆ—è¡¨å’Œç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] UI ä¸é›¶å”®å¥—é¤æ¨¡å—é«˜åº¦ä¸€è‡´
- [ ] æ—  JavaScript é”™è¯¯æˆ–è­¦å‘Š
- [ ] å“åº”å¼è®¾è®¡åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šæ­£å¸¸
- [ ] API è°ƒç”¨æ­£å¸¸ï¼Œæ•°æ®è”åŠ¨æ­£ç¡®
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼ˆTypeScriptã€Material-UI v7ï¼‰

---

## ä¼šè¯ 4ï¼šå‰ç«¯è¯¦æƒ…å’Œå®Œå–„

**ç›®æ ‡**ï¼šå®ŒæˆåˆåŒè¯¦æƒ…å¯¹è¯æ¡†ã€å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ï¼Œå¹¶è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•

### ç¬¬ä¸€æ­¥ï¼šåˆ†æå‚è€ƒæ¨¡å—ä»£ç  âš ï¸

#### 4.1 åˆ†æè¯¦æƒ…å¯¹è¯æ¡†å®ç°

**å¿…è¯»æ–‡ä»¶**ï¼š
```
frontend/src/components/PackageDetailsDialog.tsx
```

**åˆ†æé‡ç‚¹**ï¼š
- [ ] åªè¯»æ•°æ®çš„å±•ç¤ºæ–¹å¼ï¼ˆTypography + Gridï¼‰
- [ ] "æ ‡ç­¾-å€¼"å¯¹çš„æ ·å¼è®¾è®¡
- [ ] æ“ä½œæ æŒ‰é’®çš„é…ç½®
- [ ] ä»ç¼–è¾‘å¯¹è¯æ¡†æ‰“å¼€è¯¦æƒ…å¯¹è¯æ¡†çš„é€»è¾‘

### ç¬¬äºŒæ­¥ï¼šå¼€å‘ä»»åŠ¡

#### 2.1 åˆ›å»ºåˆåŒè¯¦æƒ…å¯¹è¯æ¡†

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/components/ContractDetailsDialog.tsx`

**å¼ºåˆ¶è¦æ±‚**ï¼š
- å‚è€ƒ `PackageDetailsDialog.tsx` çš„å®Œæ•´ç»“æ„
- æ‰€æœ‰è¡¨å•æ§ä»¶æ›¿æ¢ä¸º `Typography` å±•ç¤º
- ä¿æŒå¡ç‰‡ç»“æ„ä¸ç¼–è¾‘å¯¹è¯æ¡†ä¸€è‡´

#### 2.2 åˆ›å»ºå¯¼å…¥å¯¹è¯æ¡†

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/components/ContractImportDialog.tsx`

**åŠŸèƒ½è¦æ±‚**ï¼š
- æ–‡ä»¶é€‰æ‹©å™¨ï¼ˆaccept=".xlsx,.xls"ï¼‰
- ä¸Šä¼ æŒ‰é’®å’Œè¿›åº¦æç¤º
- å¯¼å…¥ç»“æœå±•ç¤ºï¼ˆæˆåŠŸ/å¤±è´¥æ•°é‡ã€é”™è¯¯è¯¦æƒ…è¡¨æ ¼ï¼‰

#### 2.3 å®ç°å¯¼å‡ºåŠŸèƒ½

åœ¨ `RetailContractPage.tsx` ä¸­æ·»åŠ ï¼š

```tsx
const handleExport = async () => {
  try {
    const response = await contractApi.export(filters);
    const blob = new Blob([response.data], {
      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `contracts_${new Date().toISOString().slice(0, 10)}.xlsx`;
    link.click();
    window.URL.revokeObjectURL(url);
  } catch (error) {
    console.error('å¯¼å‡ºå¤±è´¥', error);
    // æ˜¾ç¤ºé”™è¯¯æç¤º
  }
};
```

#### 2.4 å®Œå–„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

- æ·»åŠ å…¨å±€ `Snackbar` ç»„ä»¶ç”¨äºæ“ä½œåé¦ˆ
- å®Œå–„ `DeleteConfirmationDialog` ç»„ä»¶
- æ·»åŠ åŠ è½½çŠ¶æ€æç¤º

### ç¬¬ä¸‰æ­¥ï¼šç«¯åˆ°ç«¯æµ‹è¯•

#### 3.1 å®Œæ•´åŠŸèƒ½æµ‹è¯•æµç¨‹

**æµ‹è¯•åœºæ™¯1ï¼šåˆ›å»ºåˆåŒå®Œæ•´æµç¨‹**
1. ç™»å½•ç³»ç»Ÿï¼ˆadmin / !234qwerï¼‰
2. å¯¼èˆªåˆ°åˆåŒç®¡ç†é¡µé¢
3. ç‚¹å‡»"æ–°å¢åˆåŒ"
4. é€‰æ‹©å¥—é¤ï¼ŒéªŒè¯å¥—é¤å†…å®¹è‡ªåŠ¨å±•ç¤º
5. é€‰æ‹©å®¢æˆ·
6. å¡«å†™è´­ä¹°ç”µé‡ã€å¼€å§‹æœˆä»½ã€ç»“æŸæœˆä»½
7. ä¿å­˜å¹¶éªŒè¯æˆåŠŸæç¤º
8. éªŒè¯åˆåŒå‡ºç°åœ¨åˆ—è¡¨ä¸­ï¼ŒçŠ¶æ€æ­£ç¡®

**æµ‹è¯•åœºæ™¯2ï¼šç¼–è¾‘å’Œåˆ é™¤**
1. æ‰¾åˆ°å¾…ç”Ÿæ•ˆçŠ¶æ€çš„åˆåŒ
2. ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œä¿®æ”¹ä¿¡æ¯
3. ä¿å­˜å¹¶éªŒè¯æ›´æ–°æˆåŠŸ
4. ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼ŒéªŒè¯äºŒæ¬¡ç¡®è®¤å¯¹è¯æ¡†
5. ç¡®è®¤åˆ é™¤ï¼ŒéªŒè¯åˆåŒå·²åˆ é™¤

**æµ‹è¯•åœºæ™¯3ï¼šæŸ¥çœ‹è¯¦æƒ…**
1. æ‰¾åˆ°ä»»æ„åˆåŒï¼Œç‚¹å‡»"æŸ¥çœ‹"æŒ‰é’®
2. éªŒè¯è¯¦æƒ…å¯¹è¯æ¡†å±•ç¤ºå®Œæ•´ä¿¡æ¯
3. å¦‚æœæ˜¯å¾…ç”Ÿæ•ˆçŠ¶æ€ï¼ŒéªŒè¯"ç¼–è¾‘"æŒ‰é’®å¯è§

**æµ‹è¯•åœºæ™¯4ï¼šå¯¼å…¥åŠŸèƒ½**
1. ç‚¹å‡»"å¯¼å…¥"æŒ‰é’®
2. é€‰æ‹©æµ‹è¯• Excel æ–‡ä»¶
3. ä¸Šä¼ å¹¶éªŒè¯å¯¼å…¥ç»“æœ
4. æ£€æŸ¥æˆåŠŸå¯¼å…¥çš„åˆåŒå’Œå¤±è´¥è®°å½•çš„é”™è¯¯ä¿¡æ¯

**æµ‹è¯•åœºæ™¯5ï¼šå¯¼å‡ºåŠŸèƒ½**
1. è®¾ç½®ç­›é€‰æ¡ä»¶
2. ç‚¹å‡»"å¯¼å‡º"æŒ‰é’®
3. éªŒè¯ä¸‹è½½çš„ Excel æ–‡ä»¶æ ¼å¼å’Œå†…å®¹æ­£ç¡®

#### 3.2 å“åº”å¼è®¾è®¡æµ‹è¯•

ä½¿ç”¨ Chrome DevTools åˆ‡æ¢è®¾å¤‡è§†å›¾ï¼š
- [ ] iPhone SE (375px å®½)
- [ ] iPhone 12/13 (390px å®½)
- [ ] iPad (768px å®½)
- [ ] æ¡Œé¢ç«¯ (1200px+ å®½)

#### 3.3 æ€§èƒ½æµ‹è¯•

- [ ] åˆ›å»º 50+ æµ‹è¯•åˆåŒæ•°æ®
- [ ] æµ‹è¯•åˆ—è¡¨åŠ è½½æ€§èƒ½
- [ ] æµ‹è¯•æœç´¢å“åº”æ—¶é—´
- [ ] æµ‹è¯•å¤§æ–‡ä»¶å¯¼å…¥æ€§èƒ½

#### 3.4 å…¼å®¹æ€§æµ‹è¯•

- [ ] Chrome æµè§ˆå™¨å®Œæ•´åŠŸèƒ½æµ‹è¯•
- [ ] Firefox æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- [ ] Safari æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•ï¼ˆå¦‚å¯ç”¨ï¼‰
- [ ] ç§»åŠ¨è®¾å¤‡æµ‹è¯•

### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰ CRUD æ“ä½œæ­£å¸¸å·¥ä½œ
- [ ] å¯¼å…¥å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] å“åº”å¼è®¾è®¡åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šæ­£å¸¸
- [ ] æ—  JavaScript é”™è¯¯æˆ–è­¦å‘Š
- [ ] API å“åº”æ—¶é—´ < 2 ç§’
- [ ] ç§»åŠ¨ç«¯ä½“éªŒæµç•…
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] UI ä¸é›¶å”®å¥—é¤ã€å®¢æˆ·æ¡£æ¡ˆæ¨¡å—é«˜åº¦ä¸€è‡´

---

## å¼€å‘ç¯å¢ƒå’Œå·¥å…·

### å¿…éœ€å·¥å…·
- **åç«¯**ï¼šPython 3.8+, MongoDB, uvicorn
- **å‰ç«¯**ï¼šNode.js, npm, React 18+
- **æµ‹è¯•**ï¼šChrome DevTools, MongoDB Compass
- **APIæµ‹è¯•**ï¼šcurl, Postmanï¼ˆå¯é€‰ï¼‰

### å¼€å‘å‘½ä»¤é€ŸæŸ¥

```bash
# åç«¯å¼€å‘
Start-Process uvicorn -ArgumentList "webapp.main:app", "--reload", "--host", "0.0.0.0", "--port", "8005" -NoNewWindow -RedirectStandardOutput "tmp\uvicorn.out.log" -RedirectStandardError "tmp\uvicorn.err.log"

# å‰ç«¯å¼€å‘
Start-Process npm -ArgumentList "start", "--prefix", "frontend" -NoNewWindow -RedirectStandardOutput "tmp\frontend_dev.log" -RedirectStandardError "tmp\frontend_dev.log"

# å‰ç«¯æ„å»ºæ£€æŸ¥
npm run build --prefix frontend

# è·å–æµ‹è¯• Token (PowerShell)
$response = Invoke-RestMethod -Uri "http://127.0.0.1:8005/token" -Method Post -Body @{username="admin";password="!234qwer"} -ContentType "application/x-www-form-urlencoded"
$TOKEN = $response.access_token
```

---

## æ³¨æ„äº‹é¡¹

### ğŸ”§ å¼€å‘è§„èŒƒå’Œå¼ºåˆ¶è¦æ±‚

**âš ï¸ é‡è¦æç¤ºï¼šå¼€å§‹å¼€å‘å‰å¿…é¡»é˜…è¯»ä»¥ä¸‹æ–‡æ¡£**

1. **è®¾è®¡æ–¹æ¡ˆ**ï¼š`docs/pages/é›¶å”®åˆåŒç®¡ç†/é›¶å”®åˆåŒç®¡ç†æ¨¡å—è®¾è®¡æ–¹æ¡ˆ.md`
   - å¿…é¡»å®Œå…¨æŒ‰ç…§è®¾è®¡æ–¹æ¡ˆä¸­çš„æ¶æ„å®æ–½
   - ä¸¥æ ¼éµå¾ªä»£ç ä¸€è‡´æ€§è¦æ±‚

2. **å‰ç«¯é¡µé¢è®¾è®¡è§„èŒƒ**ï¼š`docs/å‰ç«¯é¡µé¢è®¾è®¡è§„èŒƒ.md`
   - **å¼ºåˆ¶éµå¾ª**ç¬¬ 1 èŠ‚é¡µé¢ç»“æ„è§„èŒƒï¼ˆå¤–å±‚å®¹å™¨ã€é¡µé¢æ ‡é¢˜ï¼‰
   - **å¼ºåˆ¶éµå¾ª**ç¬¬ 2 èŠ‚ç»„ä»¶æ ·å¼è§„èŒƒï¼ˆPaperã€Typographyã€Grid v7ï¼‰
   - **å¼ºåˆ¶éµå¾ª**ç¬¬ 4 èŠ‚å“åº”å¼è®¾è®¡è§„èŒƒï¼ˆç§»åŠ¨ç«¯ä¼˜å…ˆï¼‰

3. **CLAUDE.md é¡¹ç›®æŒ‡å¯¼æ–‡æ¡£**
   - ä¸¥æ ¼éµå¾ª Material-UI Grid ç»„ä»¶è¯­æ³•ï¼ˆv7ç‰ˆæœ¬ï¼‰
   - ä¸¥æ ¼éµå¾ªç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡è§„èŒƒ

### ğŸ“‹ å¼ºåˆ¶æ€§å¼€å‘æ£€æŸ¥æ¸…å•

**åç«¯å¼€å‘**ï¼š
- [ ] ä½¿ç”¨ `webapp/tools/mongo.DATABASE` å…¨å±€å®ä¾‹è¿›è¡Œæ‰€æœ‰æ•°æ®åº“æ“ä½œ
- [ ] æ‰€æœ‰æ–°ä»£ç å¿…é¡»æ·»åŠ æ˜ç¡®çš„ Python ç±»å‹æç¤º
- [ ] éµå¾ª PEP 8 è§„èŒƒ
- [ ] ä½¿ç”¨ `PyObjectId` å¤„ç† MongoDB _id å­—æ®µ
- [ ] æ‰€æœ‰ API è·¯ç”±å¿…é¡»é›†æˆ JWT è®¤è¯
- [ ] ä½¿ç”¨ `HTTPException` å¤„ç†å®¢æˆ·ç«¯é”™è¯¯
- [ ] åœ¨ `webapp/api/v1.py` ä¸­ `include_router` æ–°çš„è·¯ç”±

**å‰ç«¯å¼€å‘**ï¼š
- [ ] é¡µé¢ç»“æ„ï¼šä½¿ç”¨ `<Box sx={{ width: '100%' }}>` ä½œä¸ºå¤–å±‚å®¹å™¨
- [ ] é¡µé¢æ ‡é¢˜ï¼šä½¿ç”¨ `Breadcrumbs`
- [ ] Grid ç»„ä»¶ï¼šå¿…é¡»ä½¿ç”¨ `size` å±æ€§
- [ ] æ‰€æœ‰ API è¯·æ±‚å¿…é¡»é€šè¿‡ `frontend/src/api/client.ts` å‘å‡º
- [ ] ä½¿ç”¨ TypeScript

**å“åº”å¼è®¾è®¡**ï¼š
- [ ] é‡‡ç”¨ç§»åŠ¨ç«¯ä¼˜å…ˆçš„å“åº”å¼è®¾è®¡
- [ ] ä½¿ç”¨ Material-UI æ ‡å‡†æ–­ç‚¹ï¼š`xs`, `sm`, `md`, `lg`
- [ ] è¡¨æ ¼æ·»åŠ  `overflowX: 'auto'`
- [ ] å­—ä½“å¤§å°å“åº”å¼ï¼š`{ xs: '0.75rem', sm: '0.875rem' }`

### ğŸš« ä¸¥æ ¼ç¦æ­¢çš„é”™è¯¯åšæ³•

1. **åç«¯ç¦æ­¢**ï¼š
   - ç›´æ¥ä½¿ç”¨ MongoDB å®¢æˆ·ç«¯è€Œä¸é€šè¿‡ `DATABASE` å…¨å±€å®ä¾‹
   - ä¸æ·»åŠ ç±»å‹æç¤ºçš„ä»£ç 
   - ç¡¬ç¼–ç æ•°æ®åº“è¿æ¥ä¿¡æ¯

2. **å‰ç«¯ç¦æ­¢**ï¼š
   - ä½¿ç”¨ MUI v5 çš„ Grid è¯­æ³•ï¼š`<Grid item xs={12}>`
   - ä½¿ç”¨ `Container maxWidth="xl"` å®¹å™¨
   - ä¸ç¬¦åˆé¡¹ç›®è§„èŒƒçš„ç»„ä»¶æ ·å¼

---

## è¿›åº¦è·Ÿè¸ª

æ¯ä¸ªä¼šè¯å®Œæˆåï¼Œè¯·æ›´æ–°ä»¥ä¸‹è¿›åº¦è¡¨ï¼š

| ä¼šè¯ | å®ŒæˆçŠ¶æ€ | å®Œæˆæ—¥æœŸ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |
|------|----------|----------|----------|------|
| ä¼šè¯1 | â­• å¾…å¼€å§‹ | - | - | åç«¯åŸºç¡€æ¶æ„ + API |
| ä¼šè¯2 | â­• å¾…å¼€å§‹ | - | - | å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ |
| ä¼šè¯3 | â­• å¾…å¼€å§‹ | - | - | å‰ç«¯åˆ—è¡¨å’Œç¼–è¾‘åŠŸèƒ½ |
| ä¼šè¯4 | â­• å¾…å¼€å§‹ | - | - | å‰ç«¯è¯¦æƒ…å’Œå®Œå–„ |

---

è¿™ä¸ªå®Œå–„çš„å¼€å‘è§„åˆ’ç¡®ä¿äº†æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„ä»£ç åˆ†æè¦æ±‚ã€è¯¦ç»†çš„å¼€å‘ä»»åŠ¡å’Œå®Œæ•´çš„æµ‹è¯•æ ‡å‡†ï¼Œä¸ºé«˜è´¨é‡å®Œæˆé›¶å”®åˆåŒç®¡ç†æ¨¡å—æä¾›äº†åšå®çš„åŸºç¡€ã€‚
