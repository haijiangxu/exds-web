# 月度负荷曲线分析页面设计方案

本文档旨在详细说明“月度负荷曲线分析”页面的前端设计方案。方案基于“选项卡式分类对比视图”，旨在通过清晰的界面布局和合理的交互逻辑，为用户提供强大而友好的多维度负荷分析功能。

## 核心思想

采用选项卡（Tabs）对分析维度进行分类，将“平均趋势”、“极值对比”和“波动分析”作为三个独立的分析视角。这可以有效降低界面的初始复杂度，避免信息过载，引导用户按需进行探索，同时为未来功能的扩展提供了良好的基础。

## 功能模块详情

### 1. 筛选条件区

此区域将所有可调整的参数集中在一起，方便用户进行统一设置。

-   **组件布局**:
    -   **月份选择器 (`DatePicker`)**: 用于选择分析的年月。
    -   **快捷切换按钮 (`Button`)**: 在月份选择器两侧提供“上月”和“下月”按钮，方便快速切换。
    -   **数据范围下拉框 (`Select`)**:
        -   标签：“数据范围”
        -   选项：“总体负荷”（默认）、“绿电用户”、“非绿电用户”、“单个用户”。
    -   **用户搜索框 (`Autocomplete`)**:
        -   标签：“选择用户”
        -   **交互逻辑**: 仅当“数据范围”选择“单个用户”时可见，否则隐藏。用户可在此搜索并指定单个用户的ID。

-   **交互逻辑**:
    -   任何筛选条件（月份、数据范围、指定用户）的变更都将触发API的重新请求，并刷新下方的图表数据。

### 2. 分析图表区

此区域的核心是一个选项卡组件，用于切换不同的分析图表。

#### 选项卡一：平均曲线分析 (默认)

-   **目的**: 对比不同日期类型下的平均负荷水平。
-   **包含曲线**:
    1.  `月平均负荷`: 基准曲线。
    2.  `工作日平均负荷`: 体现生产经营日的负荷特性。
    3.  `周末平均负荷`: 体现周末休息日的负荷特性。
    4.  `节假日平均负荷`: 体现特殊假期的负荷特性。

#### 选项卡二：极值曲线分析

-   **目的**: 分析当月的负荷极限情况，并与平均水平进行对比。
-   **包含曲线**:
    1.  `最大负荷曲线`: 展示一天中各时刻出现的最高负荷。
    2.  `最小负荷曲线`: 展示一天中各时刻出现的最低负荷。
    3.  `月平均负荷`: 作为基准线一同展示，用于直观评估极值与平均水平的偏离程度。

#### 选项卡三：负荷波动率分析

-   **目的**: 评估负荷在一天中各个时刻的稳定性。
-   **包含曲线**:
    1.  `负荷波动率曲线`: 该曲线表示在96个时间点上，负荷的标准差（或方差）。曲线越高，表示该时刻的负荷越不稳定，波动越大。
    2.  `月平均负荷`: （可选）可将月平均负荷曲线作为背景或次要曲线，以观察波动与负荷大小的关系。

## API 与数据结构变更

### API 请求

-   **Endpoint**: `GET /api/v1/load_analysis/monthly_curve`
-   **Query 参数**:
    -   `month` (string, required): 格式 `YYYY-MM`。
    -   `scope` (string, optional): 数据范围，可为 `overall`, `green_power`, `non_green_power`, `single`。
    -   `user_id` (string, optional): 当 `scope` 为 `single` 时必需。

### 数据结构

API应返回一个包含96个数据点的数组，每个数据点对象的结构如下：

```json
{
  "time_index": 0, // 0-95 的时间点索引
  "monthly_avg": 3100.5,
  "workday_avg": 3300.0,
  "weekend_avg": 2600.8,
  "holiday_avg": 2450.2,
  "max_load": 4500.0,
  "min_load": 1800.0,
  "load_volatility": 150.7 // 负荷波动率指标，如标准差
}
```

## 方案优势

1.  **清晰直观**: 通过Tab分类，避免了在一个图表中堆叠过多曲线导致的混乱，降低了用户的认知负荷。
2.  **用户友好**: 引导性强，用户可以轻松地在“看平均”、“看极值”、“看稳定”三种分析模式间切换。
3.  **高性能**: 所有数据一次性加载，Tab切换仅为前端渲染状态的改变，响应迅速，体验流畅。
4.  **高扩展性**: 未来若增加新的分析维度（如“负荷预测对比”），只需简单地增加一个新的Tab和对应的曲线即可，对现有布局无影响。

## 通用设计要求

### 1. 峰谷时段背景高亮

-   **适用范围**: 所有展示96点日曲线的图表，包括本页面的所有选项卡。
-   **需求描述**: 图表背景应根据“尖、峰、平、谷”时段划分，使用不同的颜色块进行高亮，以帮助用户直观地将曲线波动与电价时段关联起来。
-   **实现参考**: 可参考项目中已有的 `PriceCurveComparisonTab.tsx` 组件或 `MonthlyLoadCurveAnalysisTab.tsx` 中现存的背景渲染逻辑，将其封装为通用组件或函数，方便在各图表模块中复用。

### 2. 移动端横屏适配与快捷切换

-   **适用范围**: 所有包含图表的核心分析页面。
-   **需求描述**:
    -   在移动设备上，图表应支持横屏查看，以获得更佳的视觉效果和更大的显示空间。可通过调用浏览器的 Fullscreen API 和 Screen Orientation API 实现。
    -   在横屏全屏模式下，屏幕左右两侧应显示“上一条”和“下一条”的快捷切换按钮。
-   **交互逻辑**: 用户点击快捷按钮可直接切换当前分析的日期或月份（例如，从“10月”切换到“9月”或“11月”），无需退出横屏模式再操作筛选器，极大提升移动端体验。
-   **实现建议**: 建议创建一个高阶组件（HOC）或一个包装器组件（Wrapper Component），如 `withFullScreenChart(...)`，来统一实现横屏检测、全屏触发、以及快捷按钮的逻辑，并应用到所有需要此功能的图表页面。