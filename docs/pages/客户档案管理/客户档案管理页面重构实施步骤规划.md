# 客户档案管理页面重构实施步骤规划

## 概述

本文档详细规划了客户档案管理页面UI重构的具体实施步骤，确保重构工作有序进行，达到与零售套餐管理页面相同的设计标准和用户体验。

## 实施策略

### 重构原则
- **渐进式重构**：分阶段实施，确保每个阶段都有可交付的成果
- **用户体验优先**：优先解决影响用户体验的关键问题
- **设计一致性**：严格遵循零售套餐页面的设计模式
- **功能完整性**：补充缺失的功能，确保功能完整

### 重构优先级
- 🚀 **高优先级**：页面布局、查询交互、响应式设计
- 🔥 **中优先级**：详情功能、状态管理、反馈系统
- ⚡ **低优先级**：性能优化、高级交互特性

---

## 第一阶段：基础页面结构重构

### 步骤1: 移除面包屑导航
**目标**：统一页面设计风格，与零售套餐页面保持一致

**具体实施**：
```tsx
// 删除以下代码
<Breadcrumbs aria-label="breadcrumb" sx={{ mb: 2 }}>
    <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
        系统管理
    </Typography>
    <Typography sx={{ fontSize: '1.2rem', fontWeight: 600 }}>
        客户档案管理
    </Typography>
</Breadcrumbs>
```

**验收标准**：
- ✅ 页面顶部无面包屑导航
- ✅ 页面布局更加简洁

### 步骤2: 重构查询筛选区域
**目标**：实现自动查询机制，优化按钮布局

**具体实施**：

#### 2.1 添加搜索图标
```tsx
import SearchIcon from '@mui/icons-material/Search';
import InputAdornment from '@mui/material/InputAdornment';

<TextField
    fullWidth
    size="small"
    label="客户名称搜索"
    value={searchParams.search || ''}
    onChange={(e) => handleFilterChange('search', e.target.value)}
    InputProps={{
        startAdornment: (
            <InputAdornment position="start">
                <SearchIcon />
            </InputAdornment>
        ),
    }}
/>
```

#### 2.2 重新布局按钮位置
```tsx
<Paper variant="outlined" sx={{ p: 2, mb: 3 }}>
    <Grid container spacing={{ xs: 1, sm: 2 }} alignItems="center">
        {/* 查询条件 */}
        <Grid size={{ xs: 12, sm: 6, md: 3 }}>
            <TextField fullWidth size="small" label="客户名称搜索" />
        </Grid>

        {/* 其他筛选条件... */}

        {/* 操作按钮 */}
        <Grid size={{ xs: 12, sm: 6, md: 2 }}>
            <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="contained" onClick={handleSearch}>刷新</Button>
                <Button variant="outlined" onClick={handleResetFilters}>重置</Button>
            </Box>
        </Grid>
    </Grid>
</Paper>
```

#### 2.3 实现自动查询机制
```tsx
// 修改handleFilterChange函数
const handleFilterChange = (field: keyof CustomerListParams, value: string) => {
    const newParams = {
        ...searchParams,
        [field]: value,
        page: 1 // 重置到第一页
    };
    setSearchParams(newParams);
    loadCustomers(newParams); // 自动触发查询
};
```

#### 2.4 优化响应式布局
```tsx
<Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 3 }}>
    <Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap', alignItems: 'center' }}>
        {/* 查询条件使用flex布局 */}
    </Box>
</Paper>
```

**验收标准**：
- ✅ 搜索框带有搜索图标
- ✅ 刷新和重置按钮与查询条件在同一区域
- ✅ 筛选条件变化时自动触发查询
- ✅ 移动端布局友好

### 步骤3: 重新设计列表区域
**目标**：优化列表布局，实现可点击的客户名称

**具体实施**：

#### 3.1 移动新增按钮位置
```tsx
<Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 } }}>
    <Box sx={{ mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
        <Typography variant="h6">客户列表</Typography>
        <Button variant="contained" color="primary" onClick={() => handleOpenDialog('create')}>
            + 新增客户
        </Button>
    </Box>
    {/* 列表内容 */}
</Paper>
```

#### 3.2 实现可点击的客户名称
```tsx
// 为客户名称添加点击事件和样式
<TableCell>
    <Typography
        sx={{
            cursor: 'pointer',
            color: 'primary.main',
            '&:hover': { textDecoration: 'underline' }
        }}
        onClick={() => handleOpenDialog('view', customer)}
    >
        {customer.user_name}
    </Typography>
</TableCell>
```

#### 3.3 添加智能操作按钮控制
```tsx
// 根据客户状态控制按钮可用性
const canEdit = (status: string) => status === 'active';
const canDelete = (status: string) => status !== 'deleted';

<IconButton
    size="small"
    onClick={() => handleOpenDialog('edit', customer)}
    disabled={!canEdit(customer.status)}
    title="编辑"
>
    <EditIcon fontSize="small" />
</IconButton>
```

#### 3.4 统一分页组件样式
```tsx
<TablePagination
    rowsPerPageOptions={[10, 20, 50]}
    component="div"
    count={pagination.total}
    rowsPerPage={pagination.size}
    page={pagination.page}
    onPageChange={(_, newPage) => handlePageChange(newPage)}
    onRowsPerPageChange={(e) => handleRowsPerPageChange(parseInt(e.target.value, 10))}
    labelRowsPerPage="每页行数"
    labelDisplayedRows={({ from, to, count }) =>
        `${from}-${to} 共 ${count} 条`
    }
/>
```

**验收标准**：
- ✅ 新增按钮位于列表顶部右侧
- ✅ 客户名称可点击查看详情
- ✅ 操作按钮根据状态控制可用性
- ✅ 分页组件样式统一

---

## 第二阶段：响应式布局实现

### 步骤4: 移动端卡片布局
**目标**：实现完整的移动端响应式设计

**具体实施**：

#### 4.1 添加移动端检测
```tsx
import { useTheme } from '@mui/material/styles';
import useMediaQuery from '@mui/material/useMediaQuery';

const CustomerManagementPage: React.FC = () => {
    const theme = useTheme();
    const isMobile = useMediaQuery(theme.breakpoints.down('sm'));
    // ...
};
```

#### 4.2 设计移动端卡片布局
```tsx
// 移动端使用卡片布局，桌面端使用表格布局
{isMobile ? (
    <Box>
        {customers.map((customer) => (
            <Paper key={customer.id} variant="outlined" sx={{ p: 2, mb: 2 }}>
                <Typography
                    variant="subtitle1"
                    gutterBottom
                    sx={{
                        cursor: 'pointer',
                        color: 'primary.main',
                        '&:hover': { textDecoration: 'underline' }
                    }}
                    onClick={() => handleOpenDialog('view', customer)}
                >
                    {customer.user_name}
                </Typography>

                {/* 客户信息展示 */}
                <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                    <Typography variant="body2" color="text.secondary">用户类型:</Typography>
                    <Chip label={customer.user_type || '-'} size="small" />
                </Box>

                {/* 其他信息... */}

                {/* 操作按钮 */}
                <Box sx={{ display: 'flex', justifyContent: 'flex-end', mt: 2 }}>
                    <IconButton size="small" onClick={() => handleOpenDialog('view', customer)}>
                        <ViewIcon fontSize="small" />
                    </IconButton>
                    {/* 其他操作按钮... */}
                </Box>
            </Paper>
        ))}
    </Box>
) : (
    // 桌面端表格布局
    <TableContainer>
        <Table>
            {/* 表格内容 */}
        </Table>
    </TableContainer>
)}
```

#### 4.3 优化响应式字体和间距
```tsx
<TableContainer component={Paper} sx={{ overflowX: 'auto' }}>
    <Table
        sx={{
            '& .MuiTableCell-root': {
                fontSize: { xs: '0.75rem', sm: '0.875rem' },
                px: { xs: 0.5, sm: 2 },
            }
        }}
    >
        {/* 表格内容 */}
    </Table>
</TableContainer>
```

**验收标准**：
- ✅ 移动端显示卡片式布局
- ✅ 桌面端显示表格布局
- ✅ 响应式字体和间距设置正确
- ✅ 移动端操作按钮布局合理

---

## 第三阶段：新增详情查看功能

### 步骤5: 开发客户详情对话框
**目标**：创建独立的客户详情查看功能

**具体实施**：

#### 5.1 创建CustomerDetailsDialog组件
```tsx
// frontend/src/components/CustomerDetailsDialog.tsx
import React, { useState, useEffect } from 'react';
import {
    Dialog, DialogTitle, DialogContent, DialogActions, Button,
    Box, CircularProgress, Paper, Typography, Grid, Chip,
    useMediaQuery, useTheme, Divider
} from '@mui/material';
import { format } from 'date-fns';

interface CustomerDetailsDialogProps {
    open: boolean;
    customerId: string | null;
    onClose: () => void;
    onEdit?: (id: string) => void;
    onCopy?: (id: string) => void;
}

export const CustomerDetailsDialog: React.FC<CustomerDetailsDialogProps> = ({
    open, customerId, onClose, onEdit, onCopy
}) => {
    // 组件实现...
};
```

#### 5.2 基本信息卡片设计
```tsx
const renderBasicInfo = () => (
    <Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 2 }}>
        <Typography variant="h6" gutterBottom>基本信息</Typography>
        <Grid container spacing={2}>
            <Grid size={{ xs: 12, md: 6 }}>
                <Typography variant="body2" color="text.secondary">客户全称</Typography>
                <Typography variant="body1" sx={{ mt: 0.5 }}>{data?.user_name}</Typography>
            </Grid>
            <Grid size={{ xs: 12, md: 6 }}>
                <Typography variant="body2" color="text.secondary">客户简称</Typography>
                <Typography variant="body1" sx={{ mt: 0.5 }}>{data?.short_name}</Typography>
            </Grid>
            {/* 其他基本信息字段... */}
        </Grid>
    </Paper>
);
```

#### 5.3 联系信息卡片设计
```tsx
const renderContactInfo = () => (
    <Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 2 }}>
        <Typography variant="h6" gutterBottom>联系信息</Typography>
        <Grid container spacing={2}>
            <Grid size={{ xs: 12, md: 6 }}>
                <Typography variant="body2" color="text.secondary">联系人</Typography>
                <Typography variant="body1" sx={{ mt: 0.5 }}>{data?.contact_person || '-'}</Typography>
            </Grid>
            {/* 其他联系信息字段... */}
        </Grid>
    </Paper>
);
```

#### 5.4 户号信息卡片设计
```tsx
const renderAccountInfo = () => (
    <Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 2 }}>
        <Typography variant="h6" gutterBottom>户号信息</Typography>
        {data?.utility_accounts?.map((account, index) => (
            <Box key={index} sx={{ mb: 2 }}>
                <Typography variant="subtitle2" gutterBottom>
                    户号: {account.account_id}
                </Typography>
                {/* 计量点信息 */}
                {account.metering_points?.map((point, pointIndex) => (
                    <Box key={pointIndex} sx={{ ml: 2, mt: 1 }}>
                        <Typography variant="body2">
                            计量点: {point.metering_point_id}
                        </Typography>
                    </Box>
                ))}
            </Box>
        ))}
    </Paper>
);
```

#### 5.5 底部操作按钮设计
```tsx
<DialogActions>
    <Button onClick={onClose}>关闭</Button>
    <Button
        variant="outlined"
        onClick={() => {
            if (customerId && onCopy) {
                onClose();
                onCopy(customerId);
            }
        }}
        disabled={!data}
    >
        复制
    </Button>
    <Button
        variant="contained"
        onClick={() => {
            if (customerId && onEdit) {
                onClose();
                onEdit(customerId);
            }
        }}
        disabled={!data || data?.status !== 'active'}
    >
        编辑
    </Button>
</DialogActions>
```

#### 5.6 防误操作设计
```tsx
// 阻止背景点击关闭对话框
const handleClose = (event: {}, reason: "backdropClick" | "escapeKeyDown") => {
    if (reason && reason === "backdropClick") {
        return;
    }
    onClose();
};

<Dialog open={open} onClose={handleClose} fullScreen={isMobile} maxWidth="md" fullWidth>
    {/* 对话框内容 */}
</Dialog>
```

**验收标准**：
- ✅ 客户详情对话框组件创建完成
- ✅ 基本信息、联系信息、户号信息三个卡片布局
- ✅ 底部操作按钮功能完整
- ✅ 防误操作机制生效

### 步骤6: 重构编辑对话框
**目标**：简化编辑对话框设计，提升用户体验

**具体实施**：

#### 6.1 简化编辑对话框结构
```tsx
// 使用卡片布局替代手风琴
<Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 2 }}>
    <Typography variant="h6" gutterBottom>基本信息</Typography>
    <Grid container spacing={{ xs: 1, sm: 2 }}>
        {/* 基本信息字段 */}
    </Grid>
</Paper>

<Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 2 }}>
    <Typography variant="h6" gutterBottom>联系信息</Typography>
    <Grid container spacing={{ xs: 1, sm: 2 }}>
        {/* 联系信息字段 */}
    </Grid>
</Paper>
```

#### 6.2 优化户号管理
```tsx
// 简化户号管理界面，避免多层嵌套对话框
const renderUtilityAccounts = () => (
    <Paper variant="outlined" sx={{ p: { xs: 1, sm: 2 }, mb: 2 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
            <Typography variant="h6">户号信息</Typography>
            <Button
                variant="outlined"
                startIcon={<AddIcon />}
                onClick={handleAddAccount}
            >
                添加户号
            </Button>
        </Box>

        {/* 户号列表 */}
        {formData.utility_accounts?.map((account, index) => (
            <Box key={index} sx={{ mb: 2 }}>
                {/* 户号内容 */}
            </Box>
        ))}
    </Paper>
);
```

#### 6.3 添加防误操作机制
```tsx
const handleClose = (event: {}, reason: "backdropClick" | "escapeKeyDown") => {
    if (saving) return;
    if (reason && reason === "backdropClick") {
        return;
    }
    onClose();
};

<Dialog open={open} onClose={handleClose} maxWidth="md" fullWidth>
    {/* 对话框内容 */}
</Dialog>
```

**验收标准**：
- ✅ 编辑对话框使用卡片布局
- ✅ 户号管理界面简化
- ✅ 防误操作机制生效
- ✅ 表单验证完善

---

## 第四阶段：状态管理和业务逻辑

### 步骤7: 实现客户状态机
**目标**：添加智能的状态管理和权限控制

**具体实施**：

#### 7.1 定义状态转换规则
```tsx
// 客户状态机规则
const CUSTOMER_STATE_TRANSITIONS = {
    active: {
        canEdit: true,
        canActivate: false,
        deactivate: true,
        delete: false
    },
    inactive: {
        canEdit: true,
        canActivate: true,
        deactivate: false,
        delete: true
    },
    deleted: {
        canEdit: false,
        canActivate: false,
        deactivate: false,
        delete: false
    }
};

// 状态判断函数
const canEdit = (status: string) => CUSTOMER_STATE_TRANSITIONS[status]?.canEdit || false;
const canDelete = (status: string) => CUSTOMER_STATE_TRANSITIONS[status]?.delete || false;
const canActivate = (status: string) => CUSTOMER_STATE_TRANSITIONS[status]?.canActivate || false;
const canDeactivate = (status: string) => CUSTOMER_STATE_TRANSITIONS[status]?.deactivate || false;
```

#### 7.2 按钮权限控制
```tsx
// 在操作按钮中应用权限控制
<IconButton
    size="small"
    onClick={() => handleOpenDialog('edit', customer)}
    disabled={!canEdit(customer.status)}
    title={canEdit(customer.status) ? "编辑" : "当前状态不允许编辑"}
>
    <EditIcon fontSize="small" />
</IconButton>

<IconButton
    size="small"
    onClick={() => handleDeleteCustomer(customer)}
    disabled={!canDelete(customer.status)}
    color="error"
    title={canDelete(customer.status) ? "删除" : "当前状态不允许删除"}
>
    <DeleteIcon fontSize="small" />
</IconButton>
```

#### 7.3 状态显示优化
```tsx
// 状态显示颜色区分
const getStatusColor = (status: string) => {
    switch (status) {
        case 'active':
            return 'success';
        case 'inactive':
            return 'warning';
        case 'deleted':
            return 'error';
        default:
            return 'default';
    }
};

const getStatusText = (status: string) => {
    switch (status) {
        case 'active':
            return '正常';
        case 'inactive':
            return '停用';
        case 'deleted':
            return '已删除';
        default:
            return status;
    }
};

<Chip
    label={getStatusText(customer.status)}
    color={getStatusColor(customer.status) as any}
    size="small"
/>
```

#### 7.4 状态相关操作
```tsx
// 添加状态变更操作
const handleDeactivateCustomer = async (customer: CustomerListItem) => {
    if (!window.confirm(`确定要停用客户"${customer.user_name}"吗？`)) {
        return;
    }

    try {
        await customerApi.deactivateCustomer(customer.id);
        loadCustomers();
        showSnackbar('客户停用成功', 'success');
    } catch (err: any) {
        showSnackbar(err.response?.data?.detail || '停用失败', 'error');
    }
};
```

**验收标准**：
- ✅ 状态转换规则定义完整
- ✅ 操作按钮权限控制生效
- ✅ 状态显示颜色区分正确
- ✅ 状态变更操作功能完整

---

## 第五阶段：用户体验优化

### 步骤8: 全局反馈系统
**目标**：实现统一的用户反馈机制

**具体实施**：

#### 8.1 实现Snackbar全局反馈
```tsx
// 添加Snackbar状态管理
const [snackbar, setSnackbar] = useState<{
    open: boolean;
    message: string;
    severity: 'success' | 'error' | 'info' | 'warning';
}>({
    open: false,
    message: '',
    severity: 'success'
});

// Snackbar辅助函数
const showSnackbar = (message: string, severity: 'success' | 'error' | 'info' | 'warning' = 'success') => {
    setSnackbar({ open: true, message, severity });
};

const handleSnackbarClose = () => {
    setSnackbar(prev => ({ ...prev, open: false }));
};
```

#### 8.2 统一操作反馈
```tsx
// 在各种操作中使用统一反馈
const handleSaveCustomer = async () => {
    try {
        await customerApi.createCustomer(formData);
        showSnackbar('客户创建成功', 'success');
        onSave();
    } catch (err: any) {
        showSnackbar(err.response?.data?.detail || '创建失败', 'error');
    }
};
```

#### 8.3 优化Loading状态
```tsx
// 统一的Loading状态显示
{loading && !customers.length ? (
    <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '400px' }}>
        <CircularProgress />
    </Box>
) : customers.length === 0 ? (
    <Box sx={{ textAlign: 'center', py: 4 }}>
        <Typography color="text.secondary">暂无数据</Typography>
    </Box>
) : (
    // 数据列表
)}
```

#### 8.4 完善错误处理
```tsx
// 统一的错误处理机制
const loadCustomers = async () => {
    setLoading(true);
    try {
        const response = await customerApi.getCustomers(searchParams);
        setCustomers(response.data.items);
        setPagination({
            page: response.data.page - 1,
            size: response.data.size,
            total: response.data.total,
            pages: response.data.pages
        });
    } catch (err: any) {
        console.error('加载客户列表失败:', err);
        showSnackbar(err.response?.data?.detail || '加载客户列表失败', 'error');
        setCustomers([]);
    } finally {
        setLoading(false);
    }
};
```

**验收标准**：
- ✅ Snackbar全局反馈组件实现
- ✅ 所有操作都有统一的反馈
- ✅ Loading状态显示优化
- ✅ 错误处理机制完善

### 步骤9: 优化交互细节
**目标**：提升用户交互体验

**具体实施**：

#### 9.1 添加Tooltip提示
```tsx
import Tooltip from '@mui/material/Tooltip';

<Tooltip title="查看客户详情">
    <IconButton size="small">
        <ViewIcon fontSize="small" />
    </IconButton>
</Tooltip>

<Tooltip title="编辑客户信息">
    <IconButton size="small">
        <EditIcon fontSize="small" />
    </IconButton>
</Tooltip>
```

#### 9.2 优化确认对话框
```tsx
// 创建标准确认对话框
const ConfirmDialog = ({ open, title, content, onConfirm, onCancel }) => (
    <Dialog
        open={open}
        onClose={(event, reason) => {
            if (reason && reason === "backdropClick") {
                return;
            }
            onCancel();
        }}
    >
        <DialogTitle>{title}</DialogTitle>
        <DialogContent>
            <Typography>{content}</Typography>
        </DialogContent>
        <DialogActions>
            <Button onClick={onCancel}>取消</Button>
            <Button onClick={onConfirm} color="error" variant="contained">
                确认删除
            </Button>
        </DialogActions>
    </Dialog>
);
```

#### 9.3 键盘快捷键支持
```tsx
// Enter键触发搜索
useEffect(() => {
    const handleKeyPress = (event: KeyboardEvent) => {
        if (event.key === 'Enter') {
            handleSearch();
        }
    };

    document.addEventListener('keypress', handleKeyPress);
    return () => document.removeEventListener('keypress', handleKeyPress);
}, [searchParams]);
```

#### 9.4 无障碍访问优化
```tsx
// 添加aria-label
<IconButton
    size="small"
    onClick={() => handleOpenDialog('view', customer)}
    aria-label={`查看客户 ${customer.user_name} 的详情`}
>
    <ViewIcon fontSize="small" />
</IconButton>
```

**验收标准**：
- ✅ 所有操作按钮都有Tooltip提示
- ✅ 确认对话框标准化
- ✅ 键盘快捷键支持
- ✅ 无障碍访问优化

---

## 第六阶段：移动端体验优化

### 步骤10: 完善移动端交互
**目标**：优化移动端用户体验

**具体实施**：

#### 10.1 移动端卡片优化
```tsx
// 优化移动端卡片信息层次
<Paper variant="outlined" sx={{ p: 2, mb: 2 }}>
    {/* 主要信息 - 客户名称 */}
    <Typography
        variant="h6"
        gutterBottom
        sx={{
            cursor: 'pointer',
            color: 'primary.main',
            '&:hover': { textDecoration: 'underline' }
        }}
        onClick={() => handleOpenDialog('view', customer)}
    >
        {customer.user_name}
    </Typography>

    {/* 次要信息分组 */}
    <Box sx={{ mb: 2 }}>
        <Typography variant="body2" color="text.secondary">基本信息</Typography>
        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mt: 1 }}>
            <Chip label={customer.user_type} size="small" variant="outlined" />
            <Chip label={customer.industry} size="small" variant="outlined" />
            <Chip label={customer.region} size="small" variant="outlined" />
        </Box>
    </Box>

    {/* 状态信息 */}
    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
        <Chip
            label={getStatusText(customer.status)}
            color={getStatusColor(customer.status) as any}
            size="small"
        />

        {/* 操作按钮 */}
        <Box sx={{ display: 'flex', gap: 0.5 }}>
            <IconButton size="small">
                <ViewIcon fontSize="small" />
            </IconButton>
            <IconButton size="small">
                <EditIcon fontSize="small" />
            </IconButton>
        </Box>
    </Box>
</Paper>
```

#### 10.2 触摸友好的按钮
```tsx
// 增大移动端按钮点击区域
<IconButton
    size="small"
    sx={{
        width: { xs: 44, sm: 40 },
        height: { xs: 44, sm: 40 }
    }}
    onClick={() => handleOpenDialog('view', customer)}
>
    <ViewIcon fontSize="small" />
</IconButton>
```

#### 10.3 移动端滚动优化
```tsx
// 表格横向滚动优化
<TableContainer
    component={Paper}
    sx={{
        overflowX: 'auto',
        '&::-webkit-scrollbar': {
            height: '6px',
        },
        '&::-webkit-scrollbar-thumb': {
            backgroundColor: 'rgba(0, 0, 0, 0.2)',
            borderRadius: '3px',
        }
    }}
>
    <Table>
        {/* 表格内容 */}
    </Table>
</TableContainer>
```

#### 10.4 移动端键盘适配
```tsx
// 避免键盘遮挡输入框
<Dialog
    open={open}
    onClose={handleClose}
    fullScreen={isMobile}
    maxWidth="md"
    fullWidth
    PaperProps={{
        sx: {
            maxHeight: { xs: '100vh', sm: '90vh' },
            overflowY: 'auto'
        }
    }}
>
    {/* 对话框内容 */}
</Dialog>
```

**验收标准**：
- ✅ 移动端卡片信息层次清晰
- ✅ 触摸按钮区域合适
- ✅ 滚动体验良好
- ✅ 键盘适配完善

---

## 第七阶段：性能和代码质量优化

### 步骤11: 代码规范统一
**目标**：统一代码架构和设计模式

**具体实施**：

#### 11.1 统一API调用模式
```tsx
// 参考零售套餐页面的API调用模式
const fetchCustomers = async () => {
    setLoading(true);
    try {
        const response = await apiClient.get('/api/v1/customers', {
            params: {
                ...searchParams,
                page: pagination.page + 1, // API is 1-indexed
                size: pagination.size,
            }
        });
        setCustomers(response.data.items);
        setPagination(prev => ({
            ...prev,
            total: response.data.total
        }));
    } catch (error: any) {
        console.error("Failed to fetch customers", error);
        showSnackbar(error.response?.data?.detail || error.message || "加载客户列表失败", 'error');
        setCustomers([]);
    } finally {
        setLoading(false);
    }
};
```

#### 11.2 统一状态管理模式
```tsx
// 参考套餐页面的状态管理模式
const [customers, setCustomers] = useState<CustomerListItem[]>([]);
const [loading, setLoading] = useState(false);
const [error, setError] = useState<string | null>(null);
const [snackbar, setSnackbar] = useState({
    open: false,
    message: '',
    severity: 'success' as const
});
```

#### 11.3 优化组件结构
```tsx
// 提取可复用的组件
const CustomerStatusChip = ({ status }: { status: string }) => (
    <Chip
        label={getStatusText(status)}
        color={getStatusColor(status) as any}
        size="small"
    />
);

const CustomerActions = ({ customer, onView, onEdit, onDelete, onCopy }) => (
    <Box sx={{ display: 'flex', gap: 0.5 }}>
        <Tooltip title="查看详情">
            <IconButton size="small" onClick={() => onView(customer)}>
                <ViewIcon fontSize="small" />
            </IconButton>
        </Tooltip>
        {/* 其他操作按钮 */}
    </Box>
);
```

#### 11.4 TypeScript类型完善
```tsx
// 完善TypeScript类型定义
interface CustomerManagementState {
    customers: CustomerListItem[];
    loading: boolean;
    error: string | null;
    pagination: PaginationState;
    searchParams: CustomerListParams;
    snackbar: SnackbarState;
}

interface SnackbarState {
    open: boolean;
    message: string;
    severity: 'success' | 'error' | 'info' | 'warning';
}
```

**验收标准**：
- ✅ API调用模式统一
- ✅ 状态管理模式一致
- ✅ 组件结构优化
- ✅ TypeScript类型完善

### 步骤12: 测试和验证
**目标**：确保重构质量和功能完整性

**具体实施**：

#### 12.1 功能完整性测试
- ✅ 客户列表加载和显示
- ✅ 搜索和筛选功能
- ✅ 分页功能
- ✅ 新增客户功能
- ✅ 编辑客户功能
- ✅ 删除客户功能
- ✅ 复制客户功能
- ✅ 查看客户详情功能

#### 12.2 响应式布局测试
- ✅ 桌面端表格布局
- ✅ 移动端卡片布局
- ✅ 平板端适配
- ✅ 不同屏幕尺寸的显示效果

#### 12.3 状态管理测试
- ✅ 状态转换规则
- ✅ 按钮权限控制
- ✅ 状态显示颜色
- ✅ 状态变更操作

#### 12.4 用户体验测试
- ✅ 自动查询机制
- ✅ 点击查看详情
- ✅ 确认对话框
- ✅ 操作反馈
- ✅ Loading状态
- ✅ 错误处理

#### 12.5 性能测试
- ✅ 页面加载速度
- ✅ 数据查询响应
- ✅ 移动端滚动性能
- ✅ 大数据量显示

**验收标准**：
- ✅ 所有功能测试通过
- ✅ 响应式布局完美适配
- ✅ 状态管理逻辑正确
- ✅ 用户体验流畅
- ✅ 性能表现良好

---

## 总结

本重构实施步骤规划详细规划了客户档案管理页面UI重构的全过程，分为7个阶段，共12个具体步骤。通过系统性的重构，将使客户档案管理页面达到与零售套餐管理页面相同的设计标准和用户体验。

### 重构成功标准

1. **设计一致性**：页面布局、交互模式、视觉风格与零售套餐页面完全一致
2. **功能完整性**：具备完整的CRUD功能和状态管理机制
3. **响应式设计**：完美支持桌面端和移动端访问
4. **用户体验**：直观、流畅、防误操作的用户交互体验
5. **代码质量**：符合项目开发规范，具有良好的可维护性

### 风险控制

1. **渐进式重构**：分阶段实施，每个阶段都有可交付成果
2. **向后兼容**：确保重构过程中不影响现有功能
3. **充分测试**：每个阶段完成后进行充分测试
4. **用户反馈**：及时收集用户反馈，持续优化

通过本实施规划的执行，客户档案管理页面将成为一个功能完整、体验优秀、设计一致的高质量页面。

---

*文档版本：v1.0*
*创建时间：2025-01-08*
*预计完成时间：根据项目资源安排*